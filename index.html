<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#111827">
    <title>Gym PWA</title>
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        :root {
            --bg: #0b1220;
            --card: #121a2b;
            --muted: rgba(255,255,255,0.6);
            --text: #fff;
            --primary: #2e7d32;
            --accent: #4f46e5;
            --danger: #dc3545;
        }

        * { box-sizing: border-box; }
        html, body { height: 100%; }
        body {
            margin: 0;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
            background: linear-gradient(180deg, #0b1220 0%, #0d1626 100%);
            color: var(--text);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container { padding: 16px 16px 96px; }
        .page { display: none; }
        .page.active { display: block; }

        .header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 16px; position: sticky; top: 0; z-index: 10;
            background: rgba(11,18,32,0.7); backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }
        .header h1 { margin: 0; font-size: 1.25rem; letter-spacing: 0.3px; }
        .header .actions { display: flex; gap: 8px; }
        .icon-btn { border: 0; background: #18233a; color: #cfd7ff; padding: 8px 10px; border-radius: 10px; cursor: pointer; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
        .card {
            background: radial-gradient(120% 120% at 100% 0%, rgba(79,70,229,0.08) 0%, rgba(255,255,255,0) 60%),
                       linear-gradient(180deg, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0.02) 100%);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 16px; padding: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.25);
        }
        .card h3 { margin: 0 0 8px 0; font-size: 0.95rem; opacity: 0.8; }
        .card .big { font-size: 1.8rem; font-weight: 800; letter-spacing: 0.5px; }

        /* Pesquisas/inputs */
        .search {
            display: grid; grid-template-columns: 1fr auto auto; gap: 10px; margin: 10px 0 16px;
        }
        .input {
            width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.12);
            background: rgba(255,255,255,0.04); color: var(--text); outline: none;
        }
        .btn { border: 0; padding: 10px 12px; border-radius: 12px; color: #fff; cursor: pointer; font-weight: 700; }
        .btn.primary { background: var(--primary); }
        .btn.accent  { background: var(--accent); }
        .btn.ghost { background: rgba(255,255,255,0.08); }
        .btn.danger { background: var(--danger); }

        /* Listas */
        .list { display: grid; gap: 10px; }
        .list-item {
            display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 10px;
            padding: 12px; background: #111b30; border: 1px solid rgba(255,255,255,0.08);
            border-radius: 14px;
        }
        .list-item .title { font-weight: 800; }
        .list-item .subtitle { font-size: 0.9rem; opacity: 0.7; }
        .kebab { border: 0; background: rgba(255,255,255,0.08); color: #cfd7ff; padding: 6px 8px; border-radius: 10px; cursor: pointer; }

        /* Navbar */
        .navbar {
            position: fixed; bottom: 0; left: 0; right: 0; z-index: 20;
            display: grid; grid-template-columns: repeat(5,1fr); gap: 4px; align-items: end;
            background: rgba(11,18,32,0.86); backdrop-filter: blur(10px);
            padding: 6px 10px 12px; border-top: 1px solid rgba(255,255,255,0.08);
        }
        .nav-item { text-align: center; font-size: 0.7rem; opacity: 0.8; }
        .nav-icon { font-size: 1.2rem; display: block; margin-bottom: 4px; }
        .nav-item.active { opacity: 1; color: #fff; }

        /* TOAST - Alterado para topo */
        .toast { 
            position: fixed; 
            left: 50%; 
            transform: translateX(-50%); 
            top: 70px; 
            background: #1f2937; 
            color: #fff; 
            padding: 10px 14px; 
            border-radius: 10px;
            opacity: 0; 
            transition: opacity .25s ease, transform .3s ease; 
            z-index: 50;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .toast.show { 
            opacity: 1;
            transform: translateX(-50%) translateY(10px);
        }

        /* MODAIS */
        .weight-modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.55); z-index: 2000; overflow-y: auto; }
        .weight-modal-content { max-width: 420px; margin: 40px auto; background: #fff; color: #111; border-radius: 18px; padding: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.35); position: relative; }
        .modal-title { margin: 0 0 12px; font-size: 1.3rem; font-weight: 800; text-align: center; }
        .form-group { margin: 10px 0; }
        .form-label { font-weight: 700; font-size: 0.9rem; color: #111; margin-bottom: 6px; display: block; }
        .form-input, .form-select { width: 100%; padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 10px; }
        .modal-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px; }
        .modal-btn { padding: 10px 12px; border: 0; border-radius: 12px; font-weight: 800; cursor: pointer; }
        .btn-cancel { background: #f3f4f6; }
        .btn-save { background: #2e7d32; color: #fff; }
        .btn-danger { background: #fee2e2; color: #b00020; }
        .modal-exercise-select {
            width: 100%;
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0,12);
            background: rgba(255, 255, 255, 0,04);
            color: black;
            outline: none;
            margin-bottom: 12px;
        }

        /* Página EXERCÍCIO - Detalhes */
        .exercise-detail-header { display: grid; grid-template-columns: auto 1fr auto; gap: 10px; align-items: center; }
        .back-button { border: none; background: #18233a; color: #cfd7ff; padding: 8px 10px; border-radius: 10px; cursor: pointer; }
        .exercise-detail-title { margin: 0; }
        .edit-exercise-button { border: none; background: #f5f5f5; border-radius: 12px; padding: 8px 12px; font-size: 1.1rem; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .edit-exercise-button i { pointer-events: none; }
        .exercise-media-card { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin: 14px 0 10px; }
        .media-box { position: relative; border: 2px dashed #e0e0e0; border-radius: 16px; height: 160px; display: flex; align-items: center; justify-content: center; background: #fafafa; }
        .media-label { font-weight: 600; opacity: 0.7; }
        .media-menu { position: absolute; top: 8px; right: 8px; border: none; background: white; border-radius: 12px; padding: 6px 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.12); cursor: pointer; }

        .plan-day-exercises-list { margin-top: 8px; }
        .exercise-row { display: flex; align-items: center; justify-content: space-between; background: #fff; color:#111; border-radius: 14px; padding: 10px 12px; margin: 8px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.06); }
        .exercise-row-main { display: flex; flex-direction: column; gap: 2px; }
        .exercise-row-name { font-weight: 800; }
        .exercise-row-meta { font-size: 0.9rem; opacity: 0.7; }
        .exercise-row-options { border: none; background: #f3f3f3; border-radius: 12px; padding: 6px 8px; cursor: pointer; }
        .add-exercise-inline { width: 100%; border: none; border-radius: 14px; padding: 10px 12px; background: #f7f7f7; color:#111; margin-top: 8px; cursor: pointer; }

        .plan-detail-footer { display: grid; gap: 12px; margin-top: 12px; position: static; bottom: 92px; }
        .btn-remove-plan { flex: 1; background: #ffe7e7; color: #b00020; border: none; padding: 12px; border-radius: 14px; font-weight: 800; cursor: pointer; }
        .btn-save-plan { flex: 2; background: #2e7d32; color: white; border: none; padding: 12px; border-radius: 14px; font-weight: 800; cursor: pointer; }

        /* Garante que modais personalizados não aparecem no fim das páginas */
        .plan-modal { display: none; }

        #weightCard {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        #weightCard button {
            border: none;
            background: var(--primary);
            color: white;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
        }
        
        /* Estilo para a lista de pesos */
        #weightList {
            margin-top: 20px;
            display: grid;
            gap: 10px;
        }
        #weightList li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--card);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.08);
            color: var(--text);
        }
        .delete-weight-btn {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
        }

        /* estilo simples para os day-cards - MODIFICADO para usar a cor original */
        .day-card {
            padding: 14px;
            margin-bottom: 16px;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.1);
            background: var(--card);
            position: relative;
            cursor: default;
            border: 1px solid rgba(255,255,255,0.08);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .day-card h5 { margin: 0 0 6px 0; font-weight: 700; color: var(--text); }
        .day-card small { color: var(--muted); }

        /* Quadrado do dia - NOVO */
        .day-number-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            background: var(--accent);
            border-radius: 8px;
            font-weight: bold;
        }
        .day-number-box div:first-child {
            font-size: 0.7rem;
            opacity: 0.8;
        }
        .day-number-box div:last-child {
            font-size: 1.2rem;
        }

        /* Estilo para a lista de seleção de planos */
        .plan-selection-item {
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            color: white;
        }
        .plan-selection-item:hover {
            background: rgba(255,255,255,0.05);
        }
        .plan-selection-item:last-child {
            border-bottom: none;
        }
        .plan-selection-item .title {
            font-weight: 700;
            margin-bottom: 4px;
        }
        .plan-selection-item .subtitle {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* Espaçamento na página de peso */
        #weightPage .card {
            margin-bottom: 16px;
        }

        /* Página de detalhes do dia - REDESENHADA conforme a imagem */
        .day-detail-exercise {
            background: var(--card);
            color: var(--text);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .day-detail-exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .day-detail-exercise-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin: 0;
        }
        .day-detail-exercise-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .day-detail-exercise-sets {
            font-weight: 600;
        }
        .day-detail-exercise-weight {
            font-weight: 600;
            color: var(--primary);
        }
        .start-workout-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 1.1rem;
            width: 100%;
            margin-top: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Página de treinos (histórico) - MODIFICADO conforme solicitado */
        .workout-item-compact {
            background: var(--card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid rgba(255,255,255,0.08);
            cursor: pointer;
        }
        .workout-header-compact {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        .workout-title-compact {
            font-weight: 700;
            font-size: 1rem;
            margin: 0;
        }
        .workout-date-compact {
            opacity: 0.7;
            font-size: 0.85rem;
            text-align: right;
        }
        .workout-details-compact {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 8px;
        }
        .workout-day-compact {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        .workout-duration-compact {
            font-size: 0.9rem;
            opacity: 0.8;
            text-align: right;
        }

        .workout-exercise {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .workout-exercise:last-child {
            border-bottom: none;
        }

        /* Modal para alterar mídia */
        .media-options {
            position: absolute;
            top: 35px;
            right: 5px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            display: none;
        }
        .media-option {
            padding: 10px 14px;
            cursor: pointer;
            color: #111;
            border-bottom: 1px solid #f0f0f0;
        }
        .media-option:last-child {
            border-bottom: none;
        }
        .media-option:hover {
            background: #f5f5f5;
        }

        /* NOVAS PÁGINAS PARA O FLUXO DE TREINO */
        /* Página de exercícios do treino */
        .workout-exercise-item {
            background: var(--card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid rgba(255,255,255,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .workout-exercise-info {
            flex: 1;
        }
        .workout-exercise-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin: 0 0 4px 0;
        }
        .workout-exercise-details {
            font-size: 0.9rem;
            opacity: 0.7;
        }
        .workout-exercise-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
        }
        .workout-exercise-btn:disabled {
            background: var(--muted);
            cursor: not-allowed;
        }
        .finish-workout-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 1.1rem;
            width: 100%;
            margin-top: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Página de execução do exercício - MODIFICADO conforme solicitado */
        .exercise-execution-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            position: relative;
        }
        .exercise-execution-title {
            font-weight: 700;
            font-size: 1.3rem;
            margin: 0;
        }
        .exercise-info-btn {
            border: none;
            background: var(--accent);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
        }
        .timer-btn-small {
            border: none;
            background: var(--primary);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
        }
        .timer-active {
            background: var(--accent);
        }
        .series-grid {
            display: grid;
            gap: 8px;
            margin-bottom: 20px;
        }
        .series-item {
            background: var(--card);
            border-radius: 12px;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.08);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            align-items: center;
        }
        .series-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            grid-column: 1 / 3;
        }
        .series-number {
            font-weight: 700;
        }
        .series-inputs {
            display: contents;
        }
        .input-group {
            display: flex;
            flex-direction: column;
        }
        .input-label {
            font-size: 0.8rem;
            margin-bottom: 4px;
            opacity: 0.7;
            text-align: center;
        }
        .series-input {
            padding: 8px 10px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.12);
            background: rgba(255,255,255,0.04);
            color: var(--text);
            outline: none;
            text-align: center;
            font-size: 0.9rem;
        }
        .warmup-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }
        .finish-exercise-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 1.1rem;
            width: 100%;
            margin-top: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .finish-exercise-btn:disabled {
            background: var(--muted);
            cursor: not-allowed;
        }

        /* Página de resumo do treino */
        .workout-summary-item {
            background: linear-gradient(135deg, rgba(79,70,229,0.15) 0%, rgba(46,125,50,0.15) 100%);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.12);
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.15);
        }

        .summary-title {
            font-weight: 800;
            font-size: 1.4rem;
            margin: 0;
            background: linear-gradient(135deg, var(--accent) 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .summary-duration {
            font-size: 1rem;
            opacity: 0.9;
            background: rgba(255,255,255,0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
        }

        .summary-exercise {
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.08);
            transition: all 0.3s ease;
        }

        .summary-exercise:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .summary-exercise:last-child {
            margin-bottom: 0;
        }

        .summary-exercise-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: var(--text);
        }

        .summary-exercise-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            font-size: 0.95rem;
            opacity: 0.9;
        }

        /* Modal de detalhes do treino - MODIFICADO conforme solicitado */
        .workout-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 3000;
            overflow-y: auto;
        }
        .workout-detail-content {
            max-width: 500px;
            margin: 40px auto;
            background: var(--card);
            color: var(--text);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .workout-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            position: relative;
        }
        .workout-detail-title {
            font-weight: 700;
            font-size: 1.2rem;
            margin: 0;
        }
        .workout-detail-close {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 3001;
        }
        .workout-detail-info {
            margin-bottom: 16px;
            display: grid;
            gap: 8px;
        }
        .workout-detail-info-item {
            display: flex;
            justify-content: space-between;
        }
        .workout-detail-info-label {
            font-weight: 600;
            opacity: 0.8;
        }
        .workout-detail-info-value {
            text-align: right;
        }
        .workout-detail-exercises {
            margin-top: 16px;
        }
        .workout-detail-exercise {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
            cursor: pointer;
        }
        .workout-detail-exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .workout-detail-exercise-name {
            font-weight: 700;
            margin-bottom: 8px;
        }
        .workout-detail-exercise-details {
            display: none;
            margin-top: 8px;
        }
        .workout-detail-exercise.expanded .workout-detail-exercise-details {
            display: block;
        }
        .workout-detail-exercise-sets {
            opacity: 0.8;
            margin-bottom: 4px;
        }
        .workout-detail-set {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-bottom: 4px;
            font-size: 0.9rem;
        }
        .workout-detail-set-header {
            font-weight: 600;
            opacity: 0.7;
        }

        /* ===== ESTILOS ADICIONADOS PARA AS CORREÇÕES ===== */
        
        /* Espaçamento na página de treinos */
        #workoutsPage .card {
            margin-bottom: 16px; /* Adiciona espaçamento entre o card e a lista */
        }
        
        /* Estilo para a lista de histórico de treinos na página de exercícios */
        .exercise-history-list {
            margin-top: 16px;
            display: grid;
            gap: 12px;
        }
        
        .exercise-history-item {
            background: linear-gradient(135deg, rgba(79,70,229,0.08) 0%, rgba(46,125,50,0.08) 100%);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid rgba(255,255,255,0.08);
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        .exercise-history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }
        
        .exercise-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .exercise-history-date {
            font-weight: 700;
            font-size: 1rem;
            margin: 0;
        }

        .exercise-history-avg {
            font-weight: 700;
            color: var(--primary);
            background: rgba(46,125,50,0.15);
            padding: 4px 8px;
            border-radius: 8px;
        }

        .exercise-history-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .exercise-history-detail-item {
            display: flex;
            flex-direction: column;
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
        }

        .exercise-history-detail-label {
            font-size: 0.8rem;
            opacity: 0.6;
            margin-bottom: 4px;
        }

        .exercise-history-detail-value {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .exercise-history-expand-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .exercise-history-expand-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: rotate(180deg);
        }
        
        .exercise-history-sets {
            margin-top: 12px;
            font-size: 0.85rem;
            opacity: 0.7;
            display: none;
            background: rgba(255,255,255,0.05);
            padding: 12px;
            border-radius: 8px;
        }

        .exercise-history-sets.expanded {
            display: block;
        }
        
        .exercise-history-set {
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
        }

        .exercise-history-set:last-child {
            border-bottom: none;
        }
        
        /* Botão de eliminar treino no modal */
        .delete-workout-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 16px;
            width: 100%;
        }

        /* NOVOS ESTILOS PARA AS CORREÇÕES SOLICITADAS */
        
        /* Modal para adicionar exercício */
        .add-exercise-modal-content {
            max-width: 420px;
            margin: 40px auto;
            background: var(--card);
            color: var(--text);
            border-radius: 18px;
            padding: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.35);
            position: relative;
        }
        
        /* Modal para editar nome do exercício */
        .edit-exercise-name-modal-content {
            max-width: 420px;
            margin: 40px auto;
            background: var(--card);
            color: var(--text);
            border-radius: 18px;
            padding: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.35);
            position: relative;
        }
        
        /* Modal para confirmar remoção de exercício */
        .confirm-delete-modal-content {
            max-width: 420px;
            margin: 40px auto;
            background: var(--card);
            color: var(--text);
            border-radius: 18px;
            padding: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.35);
            position: relative;
            text-align: center;
        }
        
        /* Botão de remover exercício na página de detalhes */
        .delete-exercise-button {
            border: none;
            background: #ffebee;
            color: #d32f2f;
            border-radius: 12px;
            padding: 8px 12px;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-left: 8px;
        }
        
        .exercise-detail-header-buttons {
            display: flex;
            gap: 8px;
        }

        /* NOVOS ESTILOS PARA A MODAL DE GESTÃO DO DIA */
        .day-management-modal-content {
            max-width: 500px;
            margin: 40px auto;
            background: var(--card);
            color: var(--text);
            border-radius: 18px;
            padding: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.35);
            position: relative;
        }
        
        .day-management-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .day-management-title {
            font-weight: 700;
            font-size: 1.2rem;
            margin: 0;
        }
        
        .day-management-exercise-list {
            margin: 16px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .day-management-exercise-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: move;
        }
        
        .day-management-exercise-info {
            flex: 1;
        }
        
        .day-management-exercise-name {
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .day-management-exercise-details {
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .day-management-exercise-remove {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 6px 10px;
            cursor: pointer;
        }
        
        .day-management-footer {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        /* NOVO ESTILO PARA OS DIAS NA PÁGINA DE DETALHES DO PLANO */
        .plan-day-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--card);
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        
        .plan-day-info {
            flex: 1;
        }
        
        .plan-day-name {
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .plan-day-exercises-count {
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .plan-day-options {
            background: rgba(255,255,255,0.08);
            color: #cfd7ff;
            border: none;
            border-radius: 8px;
            padding: 8px 10px;
            cursor: pointer;
        }

        /* Estilo para modais sobrepostas - CORREÇÃO DO PROBLEMA */
        .day-options-modal-active {
            z-index: 2001 !important;
        }
        
        /* CORREÇÃO: Aumentar z-index da modal de edição do nome do dia */
        #editDayNameModal {
            z-index: 2001 !important;
        }

        /* NOVOS ESTILOS PARA FILTROS E ORDENAÇÃO */
        .filter-modal-content {
            max-width: 420px;
            margin: 40px auto;
            background: var(--card);
            color: var(--text);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.4);
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .filter-options {
            display: grid;
            gap: 16px;
            margin-bottom: 20px;
        }

        .filter-option-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: rgba(255,255,255,0.05);
            padding: 16px;
            border-radius: 12px;
        }

        .filter-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }

        .filter-checkbox:last-child {
            border-bottom: none;
        }

        .filter-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--accent);
        }

        .filter-checkbox label {
            font-weight: 500;
        }
        
        /* Estilo para a página de gestão de dia (nova página) */
        .day-management-page-content {
            padding: 16px;
        }
        
        .day-management-page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .day-management-page-title {
            font-weight: 700;
            font-size: 1.2rem;
            margin: 0;
        }
        
        .day-management-page-exercise-list {
            margin: 16px 0;
        }
        
        .day-management-page-exercise-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--card);
            border-radius: 12px;
            margin-bottom: 8px;
            border: 1px solid rgba(255,255,255,0.08);
            cursor: grab;
        }
        
        .day-management-page-exercise-item:active {
            cursor: grabbing;
        }
        
        .day-management-page-exercise-info {
            flex: 1;
        }
        
        .day-management-page-exercise-name {
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .day-management-page-exercise-details {
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .day-management-page-exercise-edit {
            background: rgba(255,255,255,0.08);
            color: #cfd7ff;
            border: none;
            border-radius: 8px;
            padding: 6px 10px;
            cursor: pointer;
            margin-right: 8px;
        }
        
        .day-management-page-exercise-remove {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 6px 10px;
            cursor: pointer;
        }
        
        .day-management-page-add-exercise {
            width: 100%;
            margin-top: 16px;
        }

        /* Estilo para a página de treinos com pesquisa */
        .workouts-search {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            margin-bottom: 16px;
        }
        
        /* Estilo para o botão de retomar treino */
        .resume-workout-card {
            background: var(--accent);
            color: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .resume-workout-info {
            flex: 1;
        }
        
        .resume-workout-title {
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .resume-workout-details {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .resume-workout-btn {
            background: white;
            color: var(--accent);
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            font-weight: 700;
            cursor: pointer;
        }

        /* Botão Iniciar Treino na Home */
        .start-workout-btn-home {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-left: auto;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .stat-date {
            font-size: 0.7rem;
            opacity: 0.6;
        }

        .stat-subtext {
            font-size: 0.7rem;
            opacity: 0.6;
        }

        /* Confirmation Modal css */
        #confirmExitModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 3002 !important;
        }

        #confirmExitModal .weight-modal-content {
            max-width: 400px;
            margin: 100px auto;
            background: var(--card);
            color: var(--text);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        #confirmExitModal p {
            margin: 15px 0;
            text-align: center;
            line-height: 1.5;
        }

        #confirmExitModal .modal-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        #deletePlanConfirmModal {
            z-index: 3003 !important;
        }

        #deleteExerciseConfirmModal {
            z-index: 3004 !important;
        }

        /* Add this CSS for the delete confirmation modal */
        #deleteWorkoutConfirmModal {
            z-index: 3001 !important;
        }

        #deleteWorkoutConfirmModal .weight-modal-content {
            max-width: 400px;
            background: var(--card);
            color: var(--text);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
        }

        #deleteWorkoutConfirmModal p {
            margin: 15px 0;
            line-height: 1.5;
        }

        /* Adicionar estes estilos para destacar objetivos atualizados */
        .plan-updated {
            animation: highlightUpdate 2s ease;
            border-left: 4px solid var(--primary) !important;
        }

        @keyframes highlightUpdate {
            0% { background-color: rgba(46, 125, 50, 0.3); }
            100% { background-color: transparent; }
        }

        .updated-badge {
            background-color: var(--primary);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        @media (max-width: 500px) {
            .series-inputs {
                grid-template-columns: 1fr !important;
                gap: 8px;
            }
            
            .series-item {
                padding: 12px;
            }
            
            .input-group {
                margin-bottom: 8px;
            }
            
            
            .header .actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>GYM</h1>
        <div class="actions">
            <!-- Removido conforme solicitado -->
        </div>
    </div>

    <div class="container">
        <!-- HOME - Adicionado card de retomar treino -->
        <div id="mainPage" class="page active">
            <div id="resumeWorkoutCard" class="resume-workout-card" style="display: none;" onclick="resumeWorkout()">
                <div class="resume-workout-info">
                    <div class="resume-workout-title">Treino em Progresso</div>
                    <div class="resume-workout-details" id="resumeWorkoutDetails">Clique para retomar</div>
                </div>
                <button class="resume-workout-btn">Retomar</button>
            </div>

            <div class="stats-grid">
                <div class="card">
                    <h3>Peso Atual</h3>
                    <div class="big" id="currentWeightLabel">0 kg</div>
                    <div class="big">
                        <button class="btn ghost" onclick="openWeightModal()"><i class="bi bi-plus-circle"></i> Adicionar Peso</button>
                    </div>
                </div>
                <div class="card">
                    <h3>Plano Selecionado</h3>
                    <div class="big" id="selectedPlanLabel">—</div>
                    <div class="big">
                        <button class="btn accent" onclick="openPlanSelection()"><i class="bi bi-list-check"></i> Escolher Plano</button>
                    </div>
                </div>
            </div>

            <div id="selectedPlanDays" style="margin-top:16px;"></div>

        </div>

        <!-- EXERCÍCIOS - Adicionado botão de filtro -->
        <div id="exercisesPage" class="page">
            <div class="search">
                <input id="exerciseSearch" class="input" placeholder="Procurar exercício..." oninput="renderExercises()" />
                <button class="btn accent" onclick="openAddExerciseModal()"><i class="bi bi-plus-circle"></i></button>
                <button class="btn ghost" onclick="openExerciseFilterModal()"><i class="bi bi-funnel"></i></button>
            </div>
            <div id="exercisesList" class="list">
                <!-- Mensagem será mostrada aqui via JavaScript -->
            </div>
        </div>

        <!-- DETALHES DO EXERCÍCIO -->
        <div id="exerciseDetailPage" class="page">
            <div class="exercise-detail-header">
                <button class="back-button" onclick="closeExerciseDetail()"><i class="bi bi-arrow-left"></i></button>
                <h1 class="exercise-detail-title" id="exerciseDetailTitle">Nome do Exercício</h1>
                <div class="exercise-detail-header-buttons">
                    <button class="edit-exercise-button" onclick="openEditExerciseNameModal()"><i class="bi bi-pencil"></i></button>
                    <button class="delete-exercise-button" onclick="openDeleteExerciseModal()"><i class="bi bi-trash"></i></button>
                </div>
            </div>

            <div class="exercise-media-card">
                <div class="media-box" id="exerciseImageBox">
                    <span class="media-label">Imagem</span>
                    <button class="media-menu" onclick="openMediaMenu('image', event)"><i class="bi bi-three-dots-vertical"></i></button>
                    <div class="media-options" id="imageOptions">
                        <div class="media-option" onclick="changeExerciseMedia('image')">Alterar Imagem</div>
                        <div class="media-option" onclick="removeExerciseMedia('image')">Remover Imagem</div>
                    </div>
                </div>
                <div class="media-box" id="exerciseGifBox">
                    <span class="media-label">GIF</span>
                    <button class="media-menu" onclick="openMediaMenu('gif', event)"><i class="bi bi-three-dots-vertical"></i></button>
                    <div class="media-options" id="gifOptions">
                        <div class="media-option" onclick="changeExerciseMedia('gif')">Alterar GIF</div>
                        <div class="media-option" onclick="removeExerciseMedia('gif')">Remover GIF</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Notas</h3>
                <textarea id="exerciseNotes" class="input" rows="4" placeholder="Notas sobre execução, dicas, etc."></textarea>
                <div style="text-align:right; margin-top:8px;"><button class="btn primary" onclick="saveExerciseNotes()">Guardar Notas</button></div>
            </div>

            <div class="card" style="margin-bottom: 14px; margin-top: 14px;">
                <h3>Estatísticas do Exercício</h3>
                <div class="stats-grid" style="grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
                    <div class="stat-item">
                        <div class="stat-label">Peso Máximo</div>
                        <div class="stat-value" id="statMaxWeight">0 kg</div>
                        <div class="stat-date" id="statMaxWeightDate">—</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Total de Sessões</div>
                        <div class="stat-value" id="statTotalSessions">0</div>
                        <div class="stat-subtext">vezes realizado</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Média de Peso</div>
                        <div class="stat-value" id="statAvgWeight">0 kg</div>
                        <div class="stat-subtext">por repetição</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Volume Total</div>
                        <div class="stat-value" id="statTotalVolume">0 kg</div>
                        <div class="stat-subtext">carga acumulada</div>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top:14px;">
                <h3>Histórico</h3>
                <canvas id="exerciseChart" height="180"></canvas>
            </div>
            
            <!-- Lista de histórico de treinos adicionada -->
            <div class="card" style="margin-top:14px;">
                <h3>Detalhes dos Treinos</h3>
                <div id="exerciseHistoryList" class="exercise-history-list"></div>
            </div>
        </div>

        <!-- PLANOS -->
        <div id="plansPage" class="page">
            <div style="display:flex; justify-content:end; margin-bottom: 10px;">
                <button class="btn primary" onclick="openPlanModal()"><i class="bi bi-plus-circle"></i> Adicionar Plano de Treino</button>
            </div>
            <div id="plansList" class="list"></div>
        </div>

        <!-- DETALHE DO PLANO -->
        <div id="planDetailPage" class="page">
            <div class="exercise-detail-header" style="margin-bottom:8px;">
                <button class="back-button" onclick="closePlanDetail()"><i class="bi bi-arrow-left"></i></button>
                <h1 class="exercise-detail-title" id="planDetailTitle">Plano</h1>
                <button class="edit-exercise-button" onclick="openEditPlanNameModal()"><i class="bi bi-pencil"></i></button>
            </div>

            <div class="card" style="margin-bottom:10px;">
                <div style="display:flex; gap:8px;">
                    <button class="btn accent" onclick="openAddDayModal()"><i class="bi bi-plus-circle"></i> Adicionar Dia</button>
                </div>
            </div>

            <div id="planDaysDetail" class="list"></div>
            <div class="plan-detail-footer">
                <button class="btn-remove-plan" onclick="removePlan()">Remover</button>
                <button class="btn-save-plan" onclick="savePlanChanges()">Guardar</button>
            </div>
        </div>

        <!-- NOVA PÁGINA: Gestão do Dia -->
        <div id="dayManagementPage" class="page">
            <div class="exercise-detail-header" style="margin-bottom:16px;">
                <button class="back-button" onclick="closeDayManagementPage()"><i class="bi bi-arrow-left"></i></button>
                <h1 class="exercise-detail-title" id="dayManagementPageTitle">Gestão do Dia</h1>
                <button class="edit-exercise-button" onclick="openEditDayNameModalFromPage()"><i class="bi bi-pencil"></i></button>
            </div>

            <div class="day-management-page-content">
                <button class="btn accent day-management-page-add-exercise" onclick="openAddExerciseToDayModalFromPage()"><i class="bi bi-plus-circle"></i> Adicionar Exercício</button>
                
                <div id="dayManagementPageExerciseList" class="day-management-page-exercise-list"></div>
            </div>
        </div>

        <!-- DETALHES DO DIA - REDESENHADO conforme a imagem -->
        <div id="dayDetailPage" class="page">
            <div class="exercise-detail-header" style="margin-bottom:16px;">
                <button class="back-button" onclick="closeDayDetail()"><i class="bi bi-arrow-left"></i></button>
                <h1 class="exercise-detail-title" id="dayDetailTitle">Dia do Treino</h1>
            </div>

            <div id="dayExercisesList"></div>

            <button class="start-workout-btn" onclick="startWorkout()">Iniciar Treino</button>
        </div>

        <!-- Weight Page -->
        <div id="weightPage" class="page">
            <div class="card" id="weightCard">
                <div>
                    <h3>Peso Atual:</h3>
                    <div class="big" id="currentWeightPageLabel">0 kg</div>
                </div>
                <button class="btn ghost" onclick="openWeightModal()"><i class="bi bi-plus-circle"></i> Adicionar Peso</button>
            </div>
            <div class="card">
                <canvas id="weightChart" height="200"></canvas>
            </div>
            <ul id="weightList" class="weight-list"></ul>
        </div>

        <!-- Página de Treinos (Histórico) - MODIFICADA com barra de pesquisa -->
        <div id="workoutsPage" class="page">
            <div class="workouts-search">
                <input id="workoutSearch" class="input" placeholder="Procurar treino..." oninput="renderWorkouts()" />
                <button class="btn ghost" onclick="openWorkoutFilterModal()"><i class="bi bi-funnel"></i></button>
            </div>

            <div id="workoutsCard" class="card">
                <h3>Histórico de Treinos</h3>
                <p>Aqui podes ver todos os teus treinos realizados.</p>
            </div>

            <div id="workoutsList" class="list"></div>
        </div>

        <!-- NOVAS PÁGINAS PARA O FLUXO DE TREINO -->
        <!-- Página de exercícios do treino -->
        <div id="workoutPage" class="page">
            <div class="exercise-detail-header" style="margin-bottom:16px;">
                <button class="back-button" onclick="closeWorkoutPage()"><i class="bi bi-arrow-left"></i></button>
                <h1 class="exercise-detail-title" id="workoutTitle">Treino</h1>
            </div>

            <div id="workoutExercisesList"></div>

            <button id="finishWorkoutBtn" class="finish-workout-btn" style="display:none;" onclick="finishWorkout()">Terminar Treino</button>
        </div>

        <!-- Página de execução do exercício - MODIFICADA conforme solicitado -->
        <div id="exerciseWorkoutPage" class="page">
            <div class="exercise-execution-header">
                <button class="back-button" onclick="closeExerciseWorkout()"><i class="bi bi-arrow-left"></i></button>
                <h1 class="exercise-execution-title" id="exerciseWorkoutTitle">Exercício</h1>
                <div>
                    <button class="timer-btn-small" id="timerBtnSmall" onclick="startTimer()"><i class="bi bi-stopwatch"></i></button>
                    <button class="exercise-info-btn" onclick="showExerciseInfo()"><i class="bi bi-info-circle"></i></button>
                </div>
            </div>

            <div class="card">
                <h3 id="exerciseWorkoutTarget"></h3>
                
                <div class="warmup-checkbox">
                    <input type="checkbox" id="warmupCheckbox" onchange="toggleWarmupSet()">
                    <label for="warmupCheckbox">Adicionar série de aquecimento</label>
                </div>
                
                <div id="seriesGrid" class="series-grid"></div>
            </div>

            <button id="finishExerciseBtn" class="finish-exercise-btn" onclick="finishExercise()">Terminar Exercício</button>
        </div>

        <!-- Página de resumo do treino -->
        <div id="workoutSummaryPage" class="page">
            <div class="exercise-detail-header" style="margin-bottom:16px;">
                <button class="back-button" onclick="closeWorkoutSummary()"><i class="bi bi-arrow-left"></i></button>
                <h1 class="exercise-detail-title">Resumo do Treino</h1>
            </div>

            <div class="workout-summary-item">
                <div class="summary-header">
                    <h2 class="summary-title" id="summaryPlanName"></h2>
                    <div class="summary-duration" id="summaryDuration"></div>
                </div>
                <div id="summaryExercisesList"></div>
            </div>

            <button class="start-workout-btn" onclick="closeWorkoutSummary()">Voltar ao Início</button>
        </div>

        <!-- MODAL PESO -->
        <div id="weightModal" class="weight-modal">
            <div class="weight-modal-content">
                <h2 class="modal-title">Adicionar Peso</h2>
                <div class="form-group"><label class="form-label">Peso (kg)</label><input id="weightInput" type="number" step="0.1" class="form-input"></div>
                <div class="form-group"><label class="form-label">Data</label><input id="weightDate" type="date" class="form-input"></div>
                <div classmodal-buttons><button class="modal-btn btn-cancel" onclick="closeWeightModal()">Cancelar</button><button class="modal-btn btn-save" onclick="saveWeight()">Guardar</button></div>
            </div>
        </div>

        <!-- MODAL ADICIONAR EXERCICIO AO DIA -->
        <div id="addExerciseToDayModal" class="weight-modal">
            <div class="weight-modal-content">
                <h2 class="modal-title">Adicionar Exercício</h2>
                <div class="form-group">
                    <label class="form-label">Exercício</label>
                    <select id="exerciseSelect" class="modal-exercise-select">
                        <option value="">Selecione um exercício</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Séries</label>
                    <input type="number" id="exerciseSets" class="form-input" min="1" placeholder="Ex: 3">
                </div>
                <div class="form-group">
                    <label class="form-label">Repetições</label>
                    <input type="number" id="exerciseReps" class="form-input" min="1" placeholder="Ex: 10">
                </div>
                <div class="form-group">
                    <label class="form-label">Peso (kg)</label>
                    <input type="number" id="exerciseWeight" class="form-input" step="0.5" min="0" placeholder="Opcional">
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn btn-cancel" onclick="closeAddExerciseToDayModal()">Cancelar</button>
                    <button class="modal-btn btn-save" onclick="saveExerciseToDay()">Salvar</button>
                </div>
            </div>
        </div>

        <!-- MODAL SELEÇÃO DE PLANO -->
        <div id="planSelectionModal" class="weight-modal">
            <div class="weight-modal-content" style="color: white; background: var(--card);">
                <h2 class="modal-title">Escolher Plano</h2>
                <div id="planSelectionList" class="list"></div>
                <div class="modal-buttons">
                    <button class="modal-btn btn-cancel" onclick="closePlanSelection()">Cancelar</button>
                </div>
            </div>
        </div>
        
        <!-- MODAL FILTRO DE EXERCÍCIOS -->
        <div id="exerciseFilterModal" class="weight-modal">
            <div class="filter-modal-content">
                <h2 class="modal-title">Filtrar e Ordenar Exercícios</h2>
                
                <div class="filter-options">
                    <div class="filter-option-group">
                        <label class="form-label" style="color: white;">Filtrar por Grupo Muscular</label>
                        <div class="filter-checkbox">
                            <input type="checkbox" id="filterChest" value="Peito">
                            <label for="filterChest">Peito</label>
                        </div>
                        <div class="filter-checkbox">
                            <input type="checkbox" id="filterBack" value="Costas">
                            <label for="filterBack">Costas</label>
                        </div>
                        <div class="filter-checkbox">
                            <input type="checkbox" id="filterLegs" value="Pernas">
                            <label for="filterLegs">Pernas</label>
                        </div>
                        <div class="filter-checkbox">
                            <input type="checkbox" id="filterShoulders" value="Ombros">
                            <label for="filterShoulders">Ombros</label>
                        </div>
                        <div class="filter-checkbox">
                            <input type="checkbox" id="filterArms" value="Braços">
                            <label for="filterArms">Braços</label>
                        </div>
                        <div class="filter-checkbox">
                            <input type="checkbox" id="filterOther" value="Outro">
                            <label for="filterOther">Outro</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" style="color: white;">Ordenar por</label>
                        <select class="form-select" id="exerciseSort">
                            <option value="name">Nome (A-Z)</option>
                            <option value="nameDesc">Nome (Z-A)</option>
                            <option value="mostPerformed">Mais Realizados</option>
                            <option value="leastPerformed">Menos Realizados</option>
                            <option value="recent">Mais Recentes</option>
                        </select>
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button class="modal-btn btn-cancel" onclick="closeExerciseFilterModal()">Cancelar</button>
                    <button class="modal-btn btn-danger" onclick="clearExerciseFilters()">Limpar</button>
                    <button class="modal-btn btn-save" onclick="applyExerciseFilters()">Aplicar</button>
                </div>
            </div>
        </div>

        <!-- MODAL FILTRO DE TREINOS -->
        <div id="workoutFilterModal" class="weight-modal">
            <div class="filter-modal-content">
                <h2 class="modal-title">Filtrar Treinos</h2>
                
                <div class="filter-options">
                    <div class="form-group">
                        <label class="form-label" style="color: white;"> Data Inicial</label>
                        <input type="date" id="workoutFilterDateStart" class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" style="color: white;"> Data Final</label>
                        <input type="date" id="workoutFilterDateEnd" class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" style="color: white;"> Plano de Treino</label>
                        <select class="form-select" id="workoutFilterPlan">
                            <option value="">Todos os planos</option>
                        </select>
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button class="modal-btn btn-cancel" onclick="closeWorkoutFilterModal()">Cancelar</button>
                    <button class="modal-btn btn-danger" onclick="clearWorkoutFilters()">Limpar</button>
                    <button class="modal-btn btn-save" onclick="applyWorkoutFilters()">Aplicar</button>
                </div>
            </div>
        </div>

        <!-- MODAL CRIAR PLANO -->
        <div id="planModal" class="weight-modal">
            <div class="weight-modal-content">
                <h2 class="modal-title" id="modalPlanTitle">Criar Plano de Treino</h2>
                <div class="form-group"><label class="form-label">Nome do Plano</label><input id="planNameInput" class="form-input" placeholder="Ex: Push/Pull/Legs"></div>
                <div class="modal-buttons"><button class="modal-btn btn-cancel" onclick="closePlanModal()">Cancelar</button><button class="modal-btn btn-save" onclick="savePlan()">Salvar Plano</button></div>
            </div>
        </div>

        <!-- MODAL ADICIONAR DIA -->
        <div id="addDayModal" class="weight-modal">
            <div class="weight-modal-content">
                <h2 class="modal-title">Adicionar Dia</h2>
                <div class="form-group"><label class="form-label">Nome do Dia</label><input id="dayNameInput" class="form-input" placeholder="Ex: Segunda-feira - Peito"></div>
                <div class="modal-buttons><button class="modal-btn btn-cancel" onclick="closeAddDayModal()">Cancelar</button><button class="modal-btn btn-save" onclick="saveDay()">Salvar</button></div>
            </div>
        </div>

        <!-- MODAL EDITAR NOME DO PLANO -->
        <div id="editPlanNameModal" class="weight-modal">
            <div class="weight-modal-content">
                <h2 class="modal-title">Editar Nome do Plano</h2>
                <div class="form-group"><label class="form-label">Nome do Plano</label><input type="text" class="form-input" id="editPlanNameInput" placeholder="Ex: Plano de Força"></div>
                <div class="modal-buttons"><button class="modal-btn btn-cancel" onclick="closeEditPlanNameModal()">Cancelar</button><button class="modal-btn btn-save" onclick="savePlanName()">Salvar</button></div>
            </div>
        </div>

        <!-- MODAL: Opções do Dia (renomear/apagar) - MODIFICADA para ter apenas remoção -->
        <div id="dayOptionsModal" class="weight-modal">
            <div class="weight-modal-content">
                <h2 class="modal-title">Remover Dia</h2>
                <p>Tem a certeza que deseja remover o dia <span id="dayNameToDelete"></span>?</p>
                <div class="modal-buttons">
                    <button class="modal-btn btn-cancel" onclick="closeDayOptionsModal()">Cancelar</button>
                    <button class="modal-btn btn-danger" onclick="removeDay()">Remover Dia</button>
                </div>
            </div>
        </div>

        <!-- MODAL: Editar Exercício do Dia - MODIFICADO (removido campo de nome) -->
        <div id="editExerciseModal" class="weight-modal">
            <div class="weight-modal-content">
                <h2 class="modal-title">Editar Exercício</h2>
                <div class="form-group">
                    <label class="form-label">Exercício</label>
                    <div class="form-input" style="background: #f3f4f6; padding: 10px 12px; border-radius: 10px; border: 1px solid #e5e7eb;" id="editExerciseNameStatic">Nome do Exercício</div>
                </div>
                <div class="form-group"><label class="form-label">Séries</label><input type="number" class="form-input" id="editExerciseSets" min="1"></div>
                <div class="form-group"><label class="form-label">Repetições</label><input type="number" class="form-input" id="editExerciseReps" min="1"></div>
                <div class="form-group"><label class="form-label">Peso (kg)</label><input type="number" class="form-input" id="editExerciseWeight" step="0.5" min="0"></div>
                <div class="modal-buttons"><button class="modal-btn btn-cancel" onclick="closeEditExerciseModal()">Cancelar</button><button class="modal-btn btn-danger" onclick="removeExerciseFromDay()">Remover Exercício</button><button class="modal-btn btn-save" onclick="saveEditedExercise()">Guardar</button></div>
            </div>
        </div>

        <!-- MODAL: Informações do Exercício -->
        <div id="exerciseInfoModal" class="weight-modal">
            <div class="weight-modal-content">
                <h2 class="modal-title" id="exerciseInfoTitle">Informações do Exercício</h2>
                <div id="exerciseInfoContent" style="max-height: 300px; overflow-y: auto;"></div>
                <div class="modal-buttons">
                    <button class="modal-btn btn-cancel" onclick="closeExerciseInfo()">Fechar</button>
                </div>
            </div>
        </div>

        <!-- MODAL: Detalhes do Treino - MODIFICADO conforme solicitado -->
        <div id="workoutDetailModal" class="workout-detail-modal">
            <div class="workout-detail-content">
                <div class="workout-detail-header">
                    <h2 class="workout-detail-title">Detalhes do Treino</h2>
                    <button class="workout-detail-close" onclick="closeWorkoutDetailModal()">&times;</button>
                </div>
                <div id="workoutDetailInfo" class="workout-detail-info"></div>
                <div id="workoutDetailExercises" class="workout-detail-exercises"></div>
                <!-- Botão para eliminar treino no modal -->
                <button class="delete-workout-btn" onclick="deleteWorkout()">Eliminar Treino</button>
            </div>
        </div>

        <!-- MODAL: Alterar Mídia -->
        <input type="file" id="mediaInput" accept="image/*" style="display: none;">

        <!-- NOVOS MODAIS ADICIONADOS PARA AS CORREÇÕES -->
        
        <!-- MODAL: Adicionar Exercício (substitui o prompt) -->
        <div id="addExerciseModal" class="weight-modal">
            <div class="weight-modal-content">
                <h2 class="modal-title">Adicionar Exercício</h2>
                <div class="form-group">
                    <label class="form-label">Nome do Exercício</label>
                    <input type="text" class="form-input" id="newExerciseName" placeholder="Ex: Supino Reto">
                </div>
                <div class="form-group">
                    <label class="form-label">Grupo Muscular</label>
                    <select class="form-select" id="newExerciseMuscle">
                        <option value="Peito">Peito</option>
                        <option value="Costas">Costas</option>
                        <option value="Pernas">Pernas</option>
                        <option value="Ombros">Ombros</option>
                        <option value="Bicep">Bicep</option>
                        <option value="Tricep">Tricep</option>
                        <option value="Antebraço">Antebraço</option>
                        <option value="Lombar">Lombar</option>
                        <option value="Trapézio">Trapézio</option>
                        <option value="Gémeos">Gémeos</option>
                        <option value="Outro">Outro</option>
                    </select>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn btn-cancel" onclick="closeAddExerciseModal()">Cancelar</button>
                    <button class="modal-btn btn-save" onclick="saveNewExercise()">Salvar</button>
                </div>
            </div>
        </div>

        <!-- MODAL: Editar Nome do Exercício (substitui o prompt) -->
        <div id="editExerciseNameModal" class="weight-modal">
            <div class="weight-modal-content">
                <h2 class="modal-title">Editar Nome do Exercício</h2>
                <div class="form-group">
                    <label class="form-label">Nome do Exercício</label>
                    <input type="text" class="form-input" id="editExerciseName" placeholder="Ex: Supino Reto">
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn btn-cancel" onclick="closeEditExerciseNameModal()">Cancelar</button>
                    <button class="modal-btn btn-save" onclick="saveExerciseName()">Salvar</button>
                </div>
            </div>
        </div>

        <!-- MODAL: Confirmar Remoção de Exercício -->
        <div id="deleteExerciseModal" class="weight-modal">
            <div class="confirm-delete-modal-content">
                <h2 class="modal-title">Remover Exercício</h2>
                <p>Tem a certeza que deseja remover o exercício <span id="exerciseNameToDelete"></span>?</p>
                <div class="modal-buttons">
                    <button class="modal-btn btn-cancel" onclick="closeDeleteExerciseModal()">Cancelar</button>
                    <button class="modal-btn btn-danger" onclick="deleteExercise()">Remover</button>
                </div>
            </div>
        </div>

        <!-- MODAL: Confirmar Remoção de Plano -->
        <div id="deletePlanConfirmModal" class="weight-modal">
            <div class="weight-modal-content" style="background: var(--card); color: var(--text);">
                <h2 class="modal-title">Remover Plano</h2>
                <p style="margin: 15px 0; text-align: center;">Tem a certeza que deseja remover permanentemente este plano de treino?</p>
                <div class="modal-buttons">
                    <button class="modal-btn btn-cancel" onclick="closeDeletePlanConfirmModal()">Cancelar</button>
                    <button class="modal-btn btn-danger" onclick="confirmRemovePlan()">Remover</button>
                </div>
            </div>
        </div>

        <!-- MODAL: Confirmar Remoção de Exercicio do Plano -->
        <div id="deleteExerciseConfirmModal" class="weight-modal">
            <div class="weight-modal-content" style="background: var(--card); color: var(--text);">
                <h2 class="modal-title">Remover Exercício</h2>
                <p style="margin: 15px 0; text-align: center;">Tem a certeza que deseja remover este exercício do dia?</p>
                <div class="modal-buttons">
                    <button class="modal-btn btn-cancel" onclick="closeDeleteExerciseConfirmModal()">Cancelar</button>
                    <button class="modal-btn btn-danger" onclick="confirmRemoveExerciseFromDay()">Remover</button>
                </div>
            </div>
        </div>

        <!-- MODAL: Confirmarçao de eliminaçao do treino -->
        <div id="deleteWorkoutConfirmModal" class="weight-modal">
            <div class="weight-modal-content" style="background: var(--card); color: var(--text);">
                <h2 class="modal-title">Eliminar Treino</h2>
                <p style="margin: 15px 0; text-align: center;">Tem a certeza que deseja eliminar permanentemente este treino?</p>
                <div class="modal-buttons">
                    <button class="modal-btn btn-cancel" onclick="closeDeleteWorkoutConfirmModal()">Cancelar</button>
                    <button class="modal-btn btn-danger" onclick="confirmDeleteWorkout()">Eliminar</button>
                </div>
            </div>
        </div>

        <!-- MODAL: Gestão do Dia (NOVA) -->
        <div id="dayManagementModal" class="weight-modal">
            <div class="day-management-modal-content">
                <div class="day-management-header">
                    <h2 class="day-management-title" id="dayManagementTitle">Gestão do Dia</h2>
                    <button class="edit-exercise-button" onclick="openEditDayNameModal()"><i class="bi bi-pencil"></i></button>
                </div>
                
                <div id="dayManagementExerciseList" class="day-management-exercise-list"></div>
                
                <button class="btn accent" style="width:100%; margin-bottom:16px;" onclick="openAddExerciseToDayModalFromManagement()">Adicionar Exercício</button>
                
                <div class="day-management-footer">
                    <button class="modal-btn btn-danger" onclick="openDayOptionsModal()">Remover Dia</button>
                    <button class="modal-btn btn-save" onclick="saveDayManagement()">Guardar</button>
                </div>
            </div>
        </div>

        <!-- NOVA MODAL: Editar Nome do Dia (semelhante à de editar nome do plano) - MOVIDA PARA DEPOIS DA MODAL DE GESTÃO DO DIA -->
        <div id="editDayNameModal" class="weight-modal">
            <div class="weight-modal-content">
                <h2 class="modal-title">Editar Nome do Dia</h2>
                <div class="form-group"><label class="form-label">Nome do Dia</label><input type="text" class="form-input" id="editDayNameInput" placeholder="Ex: Segunda - Peito"></div>
                <div class="modal-buttons"><button class="modal-btn btn-cancel" onclick="closeEditDayNameModal()">Cancelar</button><button class="modal-btn btn-save" onclick="saveDayName()">Salvar</button></div>
            </div>
        </div>

        <!-- MODAL DE CONFIRMAÇÃO PERSONALIZADO -->
        <div id="confirmExitModal" class="weight-modal">
            <div class="weight-modal-content">
                <h2 class="modal-title">Sair do Treino</h2>
                <p>Tem a certeza que deseja sair do treino? Todo o progresso não guardado será perdido.</p>
                <div class="modal-buttons">
                    <button class="modal-btn btn-cancel" onclick="closeConfirmExitModal()">Cancelar</button>
                    <button class="modal-btn btn-danger" onclick="confirmExitWorkout()">Sair do Treino</button>
                </div>
            </div>
        </div>

        <div id="toast" class="toast">Guardado!</div>
    </div>

    <!-- Navbar Fixa -->
    <div class="navbar">
        <div class="nav-item active" onclick="showPage('mainPage')"><i class="bi bi-house-fill nav-icon"></i><div>HOME</div></div>
        <div class="nav-item" onclick="showPage('exercisesPage')"><i class="bi bi-activity nav-icon"></i><div>EXERCICIOS</div></div>
        <div class="nav-item" onclick="showPage('plansPage')"><i class="bi bi-calendar-week nav-icon"></i><div>PLANOS</div></div>
        <div class="nav-item" onclick="showPage('workoutsPage')"><i class="bi bi-clock-history nav-icon"></i><div>TREINOS</div></div>
        <div class="nav-item" onclick="showPage('weightPage')"><i class="bi bi-speedometer2 nav-icon"></i><div>PESO</div></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script>
        // ===== Variáveis globais =====
        let currentWeight = 80;
        let selectedPlanId = null;
        let currentPage = 'mainPage';
        let weights = JSON.parse(localStorage.getItem("weights")) || [];
        let weightChart;
        let exerciseChart = null;
        let currentExercise = null;
        let currentPlanDetail = null;
        let currentDayForExercise = null;
        let currentDayDetail = null;
        let mediaTypeToChange = null;
        let exerciseToRemoveIndex = null;

        // Variáveis para controlar o treino atual
        let currentWorkout = null;
        let currentExerciseIndex = 0;
        let timerInterval = null;
        let timerSeconds = 120; // 2 minutos
        let workoutStartTime = null;

        // Variável para guardar o treino atualmente selecionado para detalhes
        let currentWorkoutDetail = null;

        // Variável para controlar o dia sendo gerenciado
        let currentDayManagementIndex = null;

        // Variáveis para filtros
        let exerciseFilters = {
            muscleGroups: [],
            sortBy: 'name'
        };
        
        let workoutFilters = {
            dateStart: null,
            dateEnd: null,
            plan: null
        };

        // Variável para controlar o treino em progresso
        let ongoingWorkout = JSON.parse(localStorage.getItem('fitnessOngoingWorkout')) || null;

        // Variável para controlar se o treino já foi guardado
        let isWorkoutSaved = false;

        const storageKeys = { 
            WEIGHT: 'fitnessWeight', 
            SELECTED_PLAN: 'fitnessSelectedPlan', 
            WEIGHT_HISTORY: 'fitnessWeightHistory', 
            EXERCISES: 'fitnessExercises', 
            PLANS: 'fitnessPlans',
            WORKOUTS: 'fitnessWorkouts',
            EXERCISE_MEDIA: 'fitnessExerciseMedia',
            AVAILABLE_EXERCISES: 'fitnessAvailableExercises',
            ONGOING_WORKOUT: 'fitnessOngoingWorkout'
        };

        // Exercícios disponíveis (agora carregados do localStorage)
        let availableExercises = loadAvailableExercises();

        // ===== Novas funções para gerir exercícios disponíveis =====
        function loadAvailableExercises() {
            try {
                return JSON.parse(localStorage.getItem(storageKeys.AVAILABLE_EXERCISES)) || [];
            } catch (e) {
                console.error("Erro ao carregar exercícios disponíveis:", e);
                return [];
            }
        }

        function saveAvailableExercises(exercises) {
            localStorage.setItem(storageKeys.AVAILABLE_EXERCISES, JSON.stringify(exercises));
        }

        // ===== Funções para a Página de Peso =====
        function renderWeightList() {
            const list = document.getElementById('weightList');
            const hist = loadWeightHistory();
            
            list.innerHTML = '';
            
            if (hist.length === 0) {
                list.innerHTML = '<li>Nenhum registro de peso ainda</li>';
                return;
            }
            
            hist.slice().reverse().forEach((entry, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${entry.date}</span>
                    <span>${entry.weight} kg</span>
                    <button class="delete-weight-btn" onclick="removeWeight(${hist.length - 1 - index})"><i class="bi bi-x"></i></button>
                `;
                list.appendChild(li);
            });
        }

        function removeWeight(index) {
            const hist = loadWeightHistory();
            if (index >= 0 && index < hist.length) {
                hist.splice(index, 1);
                saveWeightHistory(hist);
                initWeight();
                showToast('Peso removido!');
            }
        }

        function initWeight() {
            const hist = loadWeightHistory();
            if (hist.length > 0) {
                currentWeight = hist[hist.length - 1].weight;
                document.getElementById('currentWeightLabel').textContent = currentWeight + ' kg';
                document.getElementById('currentWeightPageLabel').textContent = currentWeight + ' kg';
            } else {
                currentWeight = 80;
                document.getElementById('currentWeightLabel').textContent = '0 kg';
                document.getElementById('currentWeightPageLabel').textContent = '0 kg';
            }
            
            const ctx = document.getElementById('weightChart');
            if (weightChart) weightChart.destroy();
            
            if (hist.length > 0) {
                weightChart = new Chart(ctx, {
                    type: 'line', 
                    data: { 
                        labels: hist.map(h => h.date), 
                        datasets: [{ 
                            label: 'Peso (kg)', 
                            data: hist.map(h => h.weight),
                            borderColor: '#4f46e5',
                            backgroundColor: 'rgba(79, 70, 229, 0.1)',
                            fill: true,
                            tension: 0.4
                        }] 
                    }, 
                    options: { 
                        responsive: true, 
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        }
                    }
                });
            } else {
                // Gráfico vazio
                weightChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Peso (kg)',
                            data: [],
                            borderColor: '#4f46e5',
                            backgroundColor: 'rgba(79, 70, 229, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: { 
                        responsive: true, 
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        }
                    }
                });
            }
            
            renderWeightList();
        }
        
        function openWeightModal(){ 
            document.getElementById('weightModal').style.display='block'; 
            document.getElementById('weightDate').value = new Date().toISOString().slice(0,10);
        }
        
        function closeWeightModal(){ document.getElementById('weightModal').style.display='none'; }
        
        function saveWeight(){ 
            const v = parseFloat(document.getElementById('weightInput').value); 
            const d = document.getElementById('weightDate').value || new Date().toISOString().slice(0,10);
            
            if (!v) {
                alert('Insira um peso.');
                return;
            } 
            
            currentWeight = v;
            document.getElementById('currentWeightLabel').textContent = v + ' kg';
            document.getElementById('currentWeightPageLabel').textContent = v + ' kg';
            
            const hist = loadWeightHistory();
            hist.push({ date: d, weight: v });
            saveWeightHistory(hist);
            
            initWeight();
            closeWeightModal();
            showToast('Peso guardado!');
        }

        // ===== Funções para a Página de Exercícios =====
        function getExercisesData(){ return loadExercisesData(); }
        
        function renderExercises(){
            const q = (document.getElementById('exerciseSearch').value || '').toLowerCase();
            const list = document.getElementById('exercisesList');
            let items = availableExercises.filter(e => e.name.toLowerCase().includes(q));
            
            // Aplicar filtros de grupo muscular
            if (exerciseFilters.muscleGroups.length > 0) {
                items = items.filter(e => exerciseFilters.muscleGroups.includes(e.muscle));
            }
            
            // Aplicar ordenação
            switch(exerciseFilters.sortBy) {
                case 'name':
                    items.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'nameDesc':
                    items.sort((a, b) => b.name.localeCompare(a.name));
                    break;
                case 'mostPerformed':
                    // Ordenar por mais realizados (precisa de implementação com dados de histórico)
                    items.sort((a, b) => {
                        const aCount = getExercisePerformanceCount(a.name);
                        const bCount = getExercisePerformanceCount(b.name);
                        return bCount - aCount;
                    });
                    break;
                case 'leastPerformed':
                    // Ordenar por menos realizados (precisa de implementação com dados de histórico)
                    items.sort((a, b) => {
                        const aCount = getExercisePerformanceCount(a.name);
                        const bCount = getExercisePerformanceCount(b.name);
                        return aCount - bCount;
                    });
                    break;
                case 'recent':
                    // Ordenar por mais recentes (precisa de implementação com dados de histórico)
                    items.sort((a, b) => {
                        const aDate = getExerciseLastPerformedDate(a.name);
                        const bDate = getExerciseLastPerformedDate(b.name);
                        return new Date(bDate) - new Date(aDate);
                    });
                    break;
            }
            
            // Verificar se não há exercícios
            if (availableExercises.length === 0) {
                list.innerHTML = '<div class="card">Sem exercícios ainda.</div>';
                return;
            }
            
            // Verificar se a pesquisa não encontró resultados
            if (items.length === 0) {
                list.innerHTML = '<div class="card">Nenhum exercício encontrado.</div>';
                return;
            }
            
            list.innerHTML = items.map(e => `
                <div class="list-item">
                    <i class="bi bi-activity"></i>
                    <div>
                        <div class="title">${e.name}</div>
                        <div class="subtitle">${e.muscle}</div>
                    </div>
                    <button class="kebab" onclick="openExerciseDetail('${e.name.replace(/'/g,"&#39;")}')"><i class="bi bi-three-dots-vertical"></i></button>
                </div>
            `).join('');
        }
        
        // Funções auxiliares para ordenação de exercícios
        function getExercisePerformanceCount(exerciseName) {
            const exercisesData = getExercisesData();
            if (exercisesData[exerciseName] && exercisesData[exerciseName].history) {
                return exercisesData[exerciseName].history.length;
            }
            return 0;
        }
        
        function getExerciseLastPerformedDate(exerciseName) {
            const exercisesData = getExercisesData();
            if (exercisesData[exerciseName] && exercisesData[exerciseName].history && exercisesData[exerciseName].history.length > 0) {
                const sortedHistory = exercisesData[exerciseName].history.sort((a, b) => new Date(b.date) - new Date(a.date));
                return sortedHistory[0].date;
            }
            return '1970-01-01'; // Data muito antiga para exercícios nunca realizados
        }
        
        // MODAL: Adicionar exercício (substitui o prompt)
        function openAddExerciseModal(dayIndex){
            currentDayForExercise = dayIndex;
            const sel = document.getElementById('exerciseSelect');
            sel.innerHTML = '<option value="">Selecione um exercício</option>' + availableExercises.map(e=>`<option value="${e.name}">${e.name}</option>`).join('');
            document.getElementById('exerciseSets').value = '';
            document.getElementById('exerciseReps').value = '';
            document.getElementById('exerciseWeight').value = '';
            document.getElementById('addExerciseModal').style.display='block';
        }
        
        function closeAddExerciseModal(){
            document.getElementById('addExerciseModal').style.display='none';
        }
        
        function saveNewExercise() {
            const name = document.getElementById('newExerciseName').value.trim();
            const muscle = document.getElementById('newExerciseMuscle').value;
            
            if (!name) {
                alert('Por favor, insira um nome para o exercício.');
                return;
            }
            
            // Verificar se já existe
            if (availableExercises.some(e => e.name.toLowerCase() === name.toLowerCase())) {
                alert('Já existe a exercício com esse nome.');
                return;
            }
            
            availableExercises.push({ name, muscle, type: muscle.toLowerCase() });
            saveAvailableExercises(availableExercises); // Salvar no localStorage
            
            const data = loadExercisesData();
            if (!data[name]) {
                data[name] = { notes: '', sets: [], history: [] };
            }
            saveExercisesData(data);
            
            renderExercises();
            closeAddExerciseModal();
            showToast('Exercício adicionado.');
        }

        // Detalhe exercício
        function openExerciseDetail(name){ 
            currentExercise=name; 
            showPage('exerciseDetailPage'); 
            document.getElementById('exerciseDetailTitle').textContent=name; 
            loadExerciseDetail(name);
            loadExerciseMedia(name);
        }
        
        function closeExerciseDetail(){ showPage('exercisesPage'); }
        
        function loadExerciseDetail(name){
            const data = getExercisesData()[name] || { notes: '', history: [] };
            document.getElementById('exerciseNotes').value = data.notes || '';
            
            updateExerciseStats(data.history || []);

            // Atualizar o gráfico para mostrar a média de peso por repetição
            const ctx = document.getElementById('exerciseChart');
            if (exerciseChart) exerciseChart.destroy();
            
            if (data.history && data.history.length > 0) {
                // Preparar dados para o gráfico
                const labels = data.history.map(h => new Date(h.startTime).toLocaleDateString('pt-PT'));
                const avgData = data.history.map(h => h.averageWeightPerRep || 0);
                const maxData = data.history.map(h => h.maxWeight || 0);
                
                exerciseChart = new Chart(ctx, { 
                    type: 'line', 
                    data: { 
                        labels: labels,
                        datasets: [
                            { 
                                label: 'Média de Peso por Repetição (kg)', 
                                data: avgData,
                                borderColor: '#4f46e5',
                                backgroundColor: 'rgba(79, 70, 229, 0.1)',
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Peso Máximo (kg)',
                                data: maxData,
                                borderColor: '#2e7d32',
                                backgroundColor: 'rgba(46, 125, 50, 0.1)',
                                fill: true,
                                tension: 0.4
                            }
                        ]
                    }, 
                    options: { 
                        responsive: true,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Kg'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Data'
                                }
                            }
                        }
                    } 
                });
            } else {
                // Gráfico vazio
                exerciseChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'Média de Peso por Repetição (kg)',
                                data: [],
                                borderColor: '#4f46e5',
                                backgroundColor: 'rgba(79, 70, 229, 0.1)',
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Peso Máximo (kg)',
                                data: [],
                                borderColor: '#2e7d32',
                                backgroundColor: 'rgba(46, 125, 50, 0.1)',
                                fill: true,
                                tension: 0.4
                            }
                        ]
                    },
                    options: { 
                        responsive: true,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Kg'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Data'
                                }
                            }
                        }
                    }
                });
            }
            
            // Carregar o histórico de exercícios
            loadExerciseHistoryList(data.history || []);
        }

        function updateExerciseStats(history) {
            if (!history || history.length === 0) {
                // Se não há histórico, definir valores padrão
                document.getElementById('statMaxWeight').textContent = '0 kg';
                document.getElementById('statMaxWeightDate').textContent = '—';
                document.getElementById('statTotalSessions').textContent = '0';
                document.getElementById('statAvgWeight').textContent = '0 kg';
                document.getElementById('statTotalVolume').textContent = '0 kg';
                return;
            }
            
            // Calcular estatísticas
            let maxWeight = 0;
            let maxWeightDate = '';
            let totalSessions = history.length;
            let totalReps = 0;
            let totalVolume = 0;
            let totalWeight = 0;
            let weightCount = 0;
            
            history.forEach(workout => {
                // Encontrar o peso máximo neste treino
                let workoutMaxWeight = 0;
                
                if (workout.sets) {
                    workout.sets.forEach(set => {
                        const weight = parseFloat(set.weight) || 0;
                        const reps = parseInt(set.repetitions) || 0;
                        
                        // Verificar peso máximo
                        if (weight > maxWeight) {
                            maxWeight = weight;
                            maxWeightDate = new Date(workout.startTime).toLocaleDateString('pt-PT');
                        }
                        
                        // Calcular totais
                        if (weight > 0) {
                            totalReps += reps;
                            totalVolume += weight * reps;
                            totalWeight += weight;
                            weightCount++;
                            
                            // Também verificar o máximo neste treino
                            if (weight > workoutMaxWeight) {
                                workoutMaxWeight = weight;
                            }
                        }
                    });
                }
                
                // Se não encontramos peso nos sets, verificar nas propriedades do workout
                if (workoutMaxWeight === 0 && workout.maxWeight) {
                    const weight = parseFloat(workout.maxWeight) || 0;
                    if (weight > maxWeight) {
                        maxWeight = weight;
                        maxWeightDate = new Date(workout.startTime).toLocaleDateString('pt-PT');
                    }
                }
            });
            
            // Calcular média de peso
            const avgWeight = weightCount > 0 ? totalWeight / weightCount : 0;
            
            // Atualizar a interface
            document.getElementById('statMaxWeight').textContent = `${maxWeight} kg`;
            document.getElementById('statMaxWeightDate').textContent = maxWeightDate || '—';
            document.getElementById('statTotalSessions').textContent = totalSessions;
            document.getElementById('statAvgWeight').textContent = `${avgWeight.toFixed(1)} kg`;
            document.getElementById('statTotalVolume').textContent = `${totalVolume.toFixed(0)} kg`;
        }
        
        // Função para carregar o histórico de exercícios na página de detalhes
        function loadExerciseHistoryList(history) {
            const container = document.getElementById('exerciseHistoryList');
            container.innerHTML = '';
            
            if (!history || history.length === 0) {
                container.innerHTML = '<div class="exercise-history-item">Nenhum treino registado ainda</div>';
                return;
            }
            
            history.sort((a, b) => new Date(b.startTime || b.date) - new Date(a.startTime || a.date));
            
            history.forEach((workout, index) => {
                const item = document.createElement('div');
                item.className = 'exercise-history-item';
                item.id = `exercise-history-${index}`;
                
                let setsHTML = '';
                if (workout.sets && workout.sets.length) {
                    setsHTML = workout.sets.map((set, i) => `
                        <div class="exercise-history-set">
                            <span>Série ${i + 1}:</span>
                            <span>${set.repetitions || 0} reps × ${set.weight || 0} kg</span>
                        </div>
                    `).join('');
                }
                
                item.innerHTML = `
                    <div class="exercise-history-header" onclick="toggleExerciseHistoryDetails(${index})">
                        <div class="exercise-history-date">${new Date(workout.startTime).toLocaleDateString('pt-PT')}</div>
                        <div class="exercise-history-avg">${workout.averageWeightPerRep ? workout.averageWeightPerRep.toFixed(2) + ' kg/rep' : 'N/A'}</div>
                    </div>
                    <div class="exercise-history-details">
                        <div class="exercise-history-detail-item">
                            <span class="exercise-history-detail-label">Séries</span>
                            <span class="exercise-history-detail-value">${workout.sets ? workout.sets.length : 0}</span>
                        </div>
                        <div class="exercise-history-detail-item">
                            <span class="exercise-history-detail-label">Reps Totais</span>
                            <span class="exercise-history-detail-value">${workout.totalReps || 0}</span>
                        </div>
                        <div class="exercise-history-detail-item">
                            <span class="exercise-history-detail-label">Volume Total</span>
                            <span class="exercise-history-detail-value">${workout.totalVolume ? workout.totalVolume.toFixed(2) + ' kg' : 'N/A'}</span>
                        </div>
                    </div>
                    <div class="exercise-history-sets" id="history-sets-${index}">
                        ${setsHTML}
                    </div>
                `;
                
                container.appendChild(item);
            });
        }
        
        function toggleExerciseHistoryDetails(index) {
            const setsElement = document.getElementById(`history-sets-${index}`);
            if (setsElement) {
                setsElement.classList.toggle('expanded');
            }
        }
        
        function saveExerciseNotes(){ const data=loadExercisesData(); if(!data[currentExercise]) data[currentExercise]={notes:'',history:[]}; data[currentExercise].notes=document.getElementById('exerciseNotes').value; saveExercisesData(data); showToast('Notas guardadas.'); }

        // Funções para gerir mídia dos exercícios
        function openMediaMenu(type, event) {
            event.stopPropagation();
            const options = document.getElementById(type + 'Options');
            options.style.display = options.style.display === 'block' ? 'none' : 'block';
            
            // Fechar outros menus abertos
            if (type === 'image') {
                document.getElementById('gifOptions').style.display = 'none';
            } else {
                document.getElementById('imageOptions').style.display = 'none';
            }
        }
        
        function changeExerciseMedia(type) {
            mediaTypeToChange = type;
            document.getElementById('mediaInput').click();
            document.getElementById(type + 'Options').style.display = 'none';
        }
        
        function removeExerciseMedia(type) {
            const mediaData = loadExerciseMediaData();
            if (!mediaData[currentExercise]) mediaData[currentExercise] = {};
            mediaData[currentExercise][type] = null;
            saveExerciseMediaData(mediaData);
            updateExerciseMediaDisplay();
            showToast(type === 'image' ? 'Imagem removida' : 'GIF removido');
            document.getElementById(type + 'Options').style.display = 'none';
        }
        
        function loadExerciseMedia(exerciseName) {
            const mediaData = loadExerciseMediaData();
            if (mediaData[exerciseName]) {
                if (mediaData[exerciseName].image) {
                    document.getElementById('exerciseImageBox').style.backgroundImage = `url(${mediaData[exerciseName].image})`;
                    document.getElementById('exerciseImageBox').style.backgroundSize = 'cover';
                    document.getElementById('exerciseImageBox').style.backgroundPosition = 'center';
                    document.querySelector('#exerciseImageBox .media-label').style.display = 'none';
                }
                
                if (mediaData[exerciseName].gif) {
                    document.getElementById('exerciseGifBox').style.backgroundImage = `url(${mediaData[exerciseName].gif})`;
                    document.getElementById('exerciseGifBox').style.backgroundSize = 'cover';
                    document.getElementById('exerciseGifBox').style.backgroundPosition = 'center';
                    document.querySelector('#exerciseGifBox .media-label').style.display = 'none';
                }
            }
        }
        
        function updateExerciseMediaDisplay() {
            const mediaData = loadExerciseMediaData();
            if (mediaData[currentExercise]) {
                if (mediaData[currentExercise].image) {
                    document.getElementById('exerciseImageBox').style.backgroundImage = `url(${mediaData[currentExercise].image})`;
                    document.getElementById('exerciseImageBox').style.backgroundSize = 'cover';
                    document.getElementById('exerciseImageBox').style.backgroundPosition = 'center';
                    document.querySelector('#exerciseImageBox .media-label').style.display = 'none';
                } else {
                    document.getElementById('exerciseImageBox').style.backgroundImage = '';
                    document.querySelector('#exerciseImageBox .media-label').style.display = 'block';
                }
                
                if (mediaData[currentExercise].gif) {
                    document.getElementById('exerciseGifBox').style.backgroundImage = `url(${mediaData[currentExercise].gif})`;
                    document.getElementById('exerciseGifBox').style.backgroundSize = 'cover';
                    document.getElementById('exerciseGifBox').style.backgroundPosition = 'center';
                    document.querySelector('#exerciseGifBox .media-label').style.display = 'none';
                } else {
                    document.getElementById('exerciseGifBox').style.backgroundImage = '';
                    document.querySelector('#exerciseGifBox .media-label').style.display = 'block';
                }
            }
        }
        
        document.getElementById('mediaInput').addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const mediaData = loadExerciseMediaData();
                    if (!mediaData[currentExercise]) mediaData[currentExercise] = {};
                    mediaData[currentExercise][mediaTypeToChange] = e.target.result;
                    saveExerciseMediaData(mediaData);
                    updateExerciseMediaDisplay();
                    showToast(mediaTypeToChange === 'image' ? 'Imagem alterada' : 'GIF alterado');
                }
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        // ===== Funções para a Página de Planos =====
        function renderPlans(){
            const plans = loadPlansData();
            const el = document.getElementById('plansList');
            if (!plans.length){ el.innerHTML = '<div class="card">Sem planos ainda.</div>'; return; }
            el.innerHTML = plans.map(p=>`
                <div class="list-item">
                    <i class="bi bi-calendar-week"></i>
                    <div>
                        <div class="title">${p.name}</div>
                        <div class="subtitle">${(p.days||[]).length} dias</div>
                    </div>
                    <button class="kebab" onclick="openPlanDetail('${p.id}')"><i class="bi bi-three-dots-vertical"></i></button>
                </div>
            `).join('');
        }

        function openPlanDetail(planId){
            const plans=loadPlansData();
            const plan=plans.find(p=>p.id===planId);
            if(!plan) return;
            currentPlanDetail = JSON.parse(JSON.stringify(plan));
            document.getElementById('planDetailTitle').textContent = currentPlanDetail.name;
            renderPlanDaysDetail(currentPlanDetail.days);
            showPage('planDetailPage');
        }
        
        function closePlanDetail(){
            showPage('plansPage');
        }

        function openEditPlanNameModal(){
            document.getElementById('editPlanNameModal').style.display='block';
            document.getElementById('editPlanNameInput').value=currentPlanDetail? currentPlanDetail.name: ''
        }
        
        function closeEditPlanNameModal(){ document.getElementById('editPlanNameModal').style.display='none'; }
        
        function savePlanName(){ const v=document.getElementById('editPlanNameInput').value.trim(); if(!v){alert('Insira um nome.');return;} currentPlanDetail.name=v; const plans=loadPlansData(); const i=plans.findIndex(p=>p.id===currentPlanDetail.id); if(i!==-1){plans[i]=currentPlanDetail; savePlansData(plans);} document.getElementById('planDetailTitle').textContent=v; renderPlans(); closeEditPlanNameModal(); showToast('Nome do plano atualizado.'); }

        function openAddDayModal(){ document.getElementById('addDayModal').style.display='block'; document.getElementById('dayNameInput').value=''; }
        
        function closeAddDayModal(){ document.getElementById('addDayModal').style.display='none'; }
        
        function saveDay(){ const n=document.getElementById('dayNameInput').value.trim(); if(!n){alert('Insira um nome.');return;} if(!currentPlanDetail.days) currentPlanDetail.days=[]; currentPlanDetail.days.push({ name:n, exercises:[] }); const plans=loadPlansData(); const i=plans.findIndex(p=>p.id===currentPlanDetail.id); if(i!==-1){plans[i]=currentPlanDetail; savePlansData(plans);} renderPlanDaysDetail(currentPlanDetail.days); closeAddDayModal(); showToast('Dia adicionado.'); }

        // MODAL: Adicionar exercício ao dia (FUNÇÕES CORRIGIDAS)
        function openAddExerciseToDayModal(dayIndex){
            currentDayForExercise = dayIndex;
            const sel = document.getElementById('exerciseSelect');
            sel.innerHTML = '<option value="">Selecione um exercício</option>' + availableExercises.map(e=>`<option value="${e.name}">${e.name}</option>`).join('');
            document.getElementById('exerciseSets').value = '';
            document.getElementById('exerciseReps').value = '';
            document.getElementById('exerciseWeight').value = '';
            document.getElementById('addExerciseToDayModal').style.display='block';
        }
        
        function closeAddExerciseToDayModal(){
            document.getElementById('addExerciseToDayModal').style.display='none';
        }
        
        function saveExerciseToDay(){
            const exerciseName = document.getElementById('exerciseSelect').value;
            const sets = document.getElementById('exerciseSets').value;
            const reps = document.getElementById('exerciseReps').value;
            const weight = document.getElementById('exerciseWeight').value;
            if(!exerciseName || !sets || !reps){ alert('Preencha os campos obrigatórios.'); return; }
            if(!currentPlanDetail || currentDayForExercise===null){ showToast('Erro: Plano/dia não carregado.'); return; }
            if(!currentPlanDetail.days[currentDayForExercise].exercises) currentPlanDetail.days[currentDayForExercise].exercises=[];
            currentPlanDetail.days[currentDayForExercise].exercises.push({ name: exerciseName, sets, reps, weight });
            const plans=loadPlansData(); const i=plans.findIndex(p=>p.id===currentPlanDetail.id); if(i!=-1){plans[i]=currentPlanDetail; savePlansData(plans);}
            
            // Refresh the day management page if it's currently open
            if (currentPage === 'dayManagementPage' && currentDayManagementIndex === currentDayForExercise) {
                renderDayManagementPageExercises(currentPlanDetail.days[currentDayManagementIndex].exercises);
            }
            
            closeAddExerciseToDayModal(); 
            showToast('Exercício adicionado.'); 
        }

        function openPlanModal(){
            const m=document.getElementById('planModal');
            if(!m) return;
            document.getElementById('modalPlanTitle').textContent='Criar Plano de Treino';
            document.getElementById('planNameInput').value='';
            m.style.display='block';
        }
        
        function closePlanModal(){
            const m=document.getElementById('planModal');
            if(m) m.style.display='none';
        }
        
        function savePlan(){
            const name=(document.getElementById('planNameInput').value||'').trim();
            if(!name){alert('Insira o nome do plano.');return;}
            const plans=loadPlansData();
            const newPlan={ id:'plan-'+Date.now(), name, days:[] };
            plans.push(newPlan); savePlansData(plans);
            closePlanModal(); renderPlans(); showToast('Plano criado with success!');
        }
        
        function savePlanChanges(){
            if(!currentPlanDetail) return;
            const plans=loadPlansData();
            const i=plans.findIndex(p=>p.id===currentPlanDetail.id);
            if(i!==-1){plans[i]=currentPlanDetail;
                savePlansData(plans);
                renderPlans(); showToast('Plano guardado!');}
        }
        
        function openDeletePlanConfirmModal() {
            document.getElementById('deletePlanConfirmModal').style.display = 'block';
        }

        function closeDeletePlanConfirmModal() {
            document.getElementById('deletePlanConfirmModal').style.display = 'none';
        }

        function confirmRemovePlan() {
            if(!currentPlanDetail) return;
            
            let plans=loadPlansData();
            plans=plans.filter(p=>p.id!==currentPlanDetail.id);
            savePlansData(plans); 
            currentPlanDetail=null;
            closeDeletePlanConfirmModal();
            closePlanDetail();
            renderPlans();
            showToast('Plano removido.');
        }

        function removePlan() {
            openDeletePlanConfirmModal();
        }

        let currentDayForEdit = null;
        
        function openDayOptionsModal(dayIndex){ 
            currentDayForEdit=dayIndex; 
            const m=document.getElementById('dayOptionsModal'); 
            if(!currentPlanDetail||!currentPlanDetail.days||!currentPlanDetail.days[dayIndex]) return; 
            const dayName = currentPlanDetail.days[dayIndex].name;
            document.getElementById('dayNameToDelete').textContent = dayName;
            m.style.display='block'; 
        }
        
        function closeDayOptionsModal(){ 
            document.getElementById('dayOptionsModal').style.display='none';
        }
        
        function removeDay(){ 
            if(currentDayForEdit===null||!currentPlanDetail) return; 
            if(!confirm('Apagar este dia?')) return; 
            currentPlanDetail.days.splice(currentDayForEdit,1); 
            const plans=loadPlansData(); 
            const i=plans.findIndex(p=>p.id===currentPlanDetail.id); 
            if(i!==-1){plans[i]=currentPlanDetail; savePlansData(plans);} 
            renderPlanDaysDetail(currentPlanDetail.days); 
            closeDayOptionsModal(); 
            showToast('Dia removido.'); 
        }

        // NOVA FUNÇÃO: Abrir modal para editar nome do dia
        function openEditDayNameModal() {
            if (currentDayManagementIndex === null || !currentPlanDetail) return;
            document.getElementById('editDayNameInput').value = currentPlanDetail.days[currentDayManagementIndex].name;
            document.getElementById('editDayNameModal').style.display = 'block';
        }
        
        // NOVA FUNÇÃO: Fechar modal de editar nome do dia
        function closeEditDayNameModal() {
            document.getElementById('editDayNameModal').style.display = 'none';
        }
        
        // NOVA FUNÇÃO: Salvar nome do dia (usando a nova modal)
        function saveDayName() {
            if (currentDayManagementIndex === null || !currentPlanDetail) return;
            const v = document.getElementById('editDayNameInput').value.trim();
            if (!v) {
                alert('Insira um nome.');
                return;
            }
            
            currentPlanDetail.days[currentDayManagementIndex].name = v;
            
            const plans = loadPlansData();
            const i = plans.findIndex(p => p.id === currentPlanDetail.id);
            if (i !== -1) {
                plans[i] = currentPlanDetail;
                savePlansData(plans);
            }
            
            // Atualizar a exibição
            document.getElementById('dayManagementTitle').textContent = v;
            renderPlanDaysDetail(currentPlanDetail.days);
            
            closeEditDayNameModal();
            showToast('Dia atualizado!');
        }

        let currentExerciseForEdit = null;
        
        function openEditExerciseModal(d,e){ 
            currentDayForEdit=d; 
            currentExerciseForEdit=e; 
            const ex=currentPlanDetail&&currentPlanDetail.days&&currentPlanDetail.days[d]&&currentPlanDetail.days[d].exercises? currentPlanDetail.days[d].exercises[e]: null; 
            if(!ex) return; 
            
            // Mostrar o nome do exercício (não editável)
            document.getElementById('editExerciseNameStatic').textContent = ex.name || '';
            document.getElementById('editExerciseSets').value=ex.sets||''; 
            document.getElementById('editExerciseReps').value=ex.reps||''; 
            document.getElementById('editExerciseWeight').value=ex.weight||''; 
            document.getElementById('editExerciseModal').style.display='block'; 
        }
        
        function closeEditExerciseModal(){ document.getElementById('editExerciseModal').style.display='none'; }
        
        function saveEditedExercise(){ 
            if(currentDayForEdit===null||currentExerciseForEdit===null) return; 
            const sets=document.getElementById('editExerciseSets').value; 
            const reps=document.getElementById('editExerciseReps').value; 
            const weight=document.getElementById('editExerciseWeight').value; 
            if(!sets||!reps){alert('Preencha os campos.');return;} 
            
            // Manter o nome original do exercício
            const name = currentPlanDetail.days[currentDayForEdit].exercises[currentExerciseForEdit].name;
            
            currentPlanDetail.days[currentDayForEdit].exercises[currentExerciseForEdit]={ name, sets, reps, weight }; 
            const plans=loadPlansData(); 
            const i=plans.findIndex(p=>p.id===currentPlanDetail.id); 
            if(i!==-1){plans[i]=currentPlanDetail; savePlansData(plans);} 
            renderPlanDaysDetail(currentPlanDetail.days); 
            closeEditExerciseModal(); 
            showToast('Exercício atualizado!'); 
        }
        
        function removeExerciseFromDay(){ if(currentDayForEdit===null||currentExerciseForEdit===null) return; if(!confirm('Remover este exercício?')) return; currentPlanDetail.days[currentDayForEdit].exercises.splice(currentExerciseForEdit,1); const plans=loadPlansData(); const i=plans.findIndex(p=>p.id===currentPlanDetail.id); if(i!==-1){plans[i]=currentPlanDetail; savePlansData(plans);} renderPlanDaysDetail(currentPlanDetail.days); closeEditExerciseModal(); showToast('Exercício removido.'); }

        // MODAL: Editar nome do exercício (substitui o prompt)
        function openEditExerciseNameModal() {
            document.getElementById('editExerciseName').value = currentExercise;
            document.getElementById('editExerciseNameModal').style.display = 'block';
        }
        
        function closeEditExerciseNameModal() {
            document.getElementById('editExerciseNameModal').style.display = 'none';
        }
        
        function saveExerciseName() {
            const novo = document.getElementById('editExerciseName').value.trim();
            if (!novo || novo === currentExercise) {
                closeEditExerciseNameModal();
                return;
            }
            
            const data = loadExercisesData();
            if (data[novo]) {
                alert('Já existe um exercício com esse nome.');
                return;
            }
            
            data[novo] = data[currentExercise] || { notes: '', sets: [], history: [] };
            delete data[currentExercise];
            saveExercisesData(data);
            
            // Atualizar no array de exercícios disponíveis
            const idx = availableExercises.findIndex(e => e.name === currentExercise);
            if (idx !== -1) {
                availableExercises[idx].name = novo;
            } else {
                availableExercises.push({ name: novo, muscle: 'Outro', type: 'other' });
            }
            saveAvailableExercises(availableExercises); // Salvar no localStorage
            
            const plans = loadPlansData();
            plans.forEach(p => (p.days || []).forEach(d => (d.exercises || []).forEach(ex => {
                if (ex.name === currentExercise) ex.name = novo;
            })));
            savePlansData(plans);
            
            currentExercise = novo;
            document.getElementById('exerciseDetailTitle').textContent = novo;
            renderExercises();
            if (currentPlanDetail) renderPlanDaysDetail(currentPlanDetail.days);
            closeEditExerciseNameModal();
            showToast('Nome do exercício atualizado!');
        }
        
        // MODAL: Remover exercício
        function openDeleteExerciseModal() {
            document.getElementById('exerciseNameToDelete').textContent = currentExercise;
            document.getElementById('deleteExerciseModal').style.display = 'block';
        }
        
        function closeDeleteExerciseModal() {
            document.getElementById('deleteExerciseModal').style.display = 'none';
        }
        
        function deleteExercise() {
            if (!currentExercise) return;
            
            // Remover dos exercícios disponíveis
            const index = availableExercises.findIndex(e => e.name === currentExercise);
            if (index !== -1) {
                availableExercises.splice(index, 1);
                saveAvailableExercises(availableExercises); // Salvar no localStorage
            }
            
            // Remover dos dados do exercício
            const data = loadExercisesData();
            if (data[currentExercise]) {
                delete data[currentExercise];
                saveExercisesData(data);
            }
            
            // Remover dos planos
            const plans = loadPlansData();
            plans.forEach(plan => {
                if (plan.days) {
                    plan.days.forEach(day => {
                        if (day.exercises) {
                            day.exercises = day.exercises.filter(ex => ex.name !== currentExercise);
                        }
                    });
                }
            });
            savePlansData(plans);
            
            closeDeleteExerciseModal();
            showToast('Exercício removido.');
            closeExerciseDetail();
            renderExercises();
        }

        // ===== NOVAS FUNÇÕES PARA A GESTÃO DO DIA =====
        function renderPlanDaysDetail(days) {
            const daysContainer = document.getElementById('planDaysDetail');
            if (!days || !days.length) {
                daysContainer.innerHTML = `<div class="card" style="text-align:center;">Nenhum dia adicionado</div>`;
                return;
            }
            
            let html = '';
            days.forEach((day, dIndex) => {
                html += `
                <div class="plan-day-item">
                    <div class="plan-day-info">
                        <div class="plan-day-name">${day.name}</div>
                        <div class="plan-day-exercises-count">${day.exercises ? day.exercises.length : 0} exercícios</div>
                    </div>
                    <button class="plan-day-options" onclick="openDayManagementPage(${dIndex})">
                        <i class="bi bi-three-dots-vertical"></i>
                    </button>
                </div>`;
            });
            daysContainer.innerHTML = html;
        }
        
        // NOVA FUNÇÃO: Abrir página de gestão do dia
        function openDayManagementPage(dayIndex) {
            currentDayManagementIndex = dayIndex;
            const day = currentPlanDetail.days[dayIndex];
            
            // Preencher o título da página
            document.getElementById('dayManagementPageTitle').textContent = day.name;
            
            // Preencher a lista de exercícios
            renderDayManagementPageExercises(day.exercises);
            
            // Mostrar a página
            showPage('dayManagementPage');
        }
        
        function closeDayManagementPage() {
            showPage('planDetailPage');
        }
        
        function renderDayManagementPageExercises(exercises) {
            const container = document.getElementById('dayManagementPageExerciseList');
            container.innerHTML = '';
            
            if (!exercises || !exercises.length) {
                container.innerHTML = '<div style="text-align:center; padding:20px; opacity:0.7;">Nenhum exercício adicionado</div>';
                return;
            }
            
            exercises.forEach((exercise, index) => {
                const exerciseEl = document.createElement('div');
                exerciseEl.className = 'day-management-page-exercise-item';
                exerciseEl.setAttribute('data-index', index);
                exerciseEl.draggable = true;
                
                exerciseEl.innerHTML = `
                    <div class="day-management-page-exercise-info">
                        <div class="day-management-page-exercise-name">${exercise.name}</div>
                        <div class="day-management-page-exercise-details">${exercise.sets} séries × ${exercise.reps} reps ${exercise.weight ? `@ ${exercise.weight} kg` : ''}</div>
                    </div>
                    <div>
                        <button class="day-management-page-exercise-edit" onclick="editExerciseFromDayManagementPage(${index})">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="day-management-page-exercise-remove" onclick="removeExerciseFromDayManagementPage(${index})">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                `;
                
                // Adicionar eventos de drag and drop
                exerciseEl.addEventListener('dragstart', handleDragStart);
                exerciseEl.addEventListener('dragover', handleDragOver);
                exerciseEl.addEventListener('drop', handleDrop);
                exerciseEl.addEventListener('dragend', handleDragEnd);
                
                container.appendChild(exerciseEl);
            });
        }
        
        // Funções para drag and drop
        let draggedItem = null;

        function handleDragStart(e) {
            draggedItem = this;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', this.getAttribute('data-index'));
            this.style.opacity = '0.5';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDrop(e) {
            e.preventDefault();
            if (draggedItem !== this) {
                const fromIndex = parseInt(draggedItem.getAttribute('data-index'));
                const toIndex = parseInt(this.getAttribute('data-index'));
                
                // Reordenar os exercícios
                const exercises = currentPlanDetail.days[currentDayManagementIndex].exercises;
                const [movedItem] = exercises.splice(fromIndex, 1);
                exercises.splice(toIndex, 0, movedItem);
                
                // Re-renderizar a lista
                renderDayManagementPageExercises(exercises);
            }
            return false;
        }

        function openDeleteExerciseConfirmModal(index) {
            exerciseToRemoveIndex = index;
            document.getElementById('deleteExerciseConfirmModal').style.display = 'block';
        }

        function closeDeleteExerciseConfirmModal() {
            document.getElementById('deleteExerciseConfirmModal').style.display = 'none';
        }

        function confirmRemoveExerciseFromDay() {
            if (exerciseToRemoveIndex === null) return;
            
            // Remover o exercício do dia
            currentPlanDetail.days[currentDayManagementIndex].exercises.splice(exerciseToRemoveIndex, 1);
            
            // Re-renderizar a lista de exercícios
            renderDayManagementPageExercises(currentPlanDetail.days[currentDayManagementIndex].exercises);
            
            // Atualizar os dados no localStorage
            const plans = loadPlansData();
            const i = plans.findIndex(p => p.id === currentPlanDetail.id);
            if (i !== -1) {
                plans[i] = currentPlanDetail;
                savePlansData(plans);
            }
            
            closeDeleteExerciseConfirmModal();
            showToast('Exercício removido.');
        }

        function handleDragEnd() {
            this.style.opacity = '1';
        }
        
        function openAddExerciseToDayModalFromPage() {
            openAddExerciseToDayModal(currentDayManagementIndex);
        }
        
        function editExerciseFromDayManagementPage(exerciseIndex) {
            openEditExerciseModal(currentDayManagementIndex, exerciseIndex);
        }
        
        function removeExerciseFromDayManagementPage(exerciseIndex) {
            openDeleteExerciseConfirmModal(exerciseIndex);
        }
        
        function openEditDayNameModalFromPage() {
            openEditDayNameModal();
        }
        
        function saveDayManagementPage() {
            // Fechar a página
            closeDayManagementPage();
            
            // Atualizar os dados no localStorage
            const plans = loadPlansData();
            const i = plans.findIndex(p => p.id === currentPlanDetail.id);
            if (i !== -1) {
                plans[i] = currentPlanDetail;
                savePlansData(plans);
            }
            
            // Re-renderizar os dias do plano
            renderPlanDaysDetail(currentPlanDetail.days);
            showToast('Alterações guardadas!');
        }

        // ===== Funções para a Página de Detalhes do Dia - ATUALIZADA conforme a imagem =====
        function openDayDetail(planId, dayIndex) {
            const plans = loadPlansData();
            const plan = plans.find(p => p.id === planId);
            if (!plan || !plan.days || !plan.days[dayIndex]) return;
            
            currentDayDetail = {
                plan: plan,
                dayIndex: dayIndex,
                day: plan.days[dayIndex]
            };
            
            document.getElementById('dayDetailTitle').textContent = currentDayDetail.day.name;
            renderDayExercises(currentDayDetail.day.exercises);
            showPage('dayDetailPage');
        }
        
        function closeDayDetail() {
            showPage('mainPage');
        }
        
        function renderDayExercises(exercises) {
            const container = document.getElementById('dayExercisesList');
            container.innerHTML = '';
            
            if (!exercises || !exercises.length) {
                container.innerHTML = '<div class="card">Nenhum exercício neste dia.</div>';
                return;
            }
            
            exercises.forEach(exercise => {
                const exerciseEl = document.createElement('div');
                exerciseEl.className = 'day-detail-exercise';
                exerciseEl.innerHTML = `
                    <div class="day-detail-exercise-header">
                        <div class="day-detail-exercise-name">${exercise.name}</div>
                    </div>
                    <div class="day-detail-exercise-details">
                        <span class="day-detail-exercise-sets">${exercise.sets}x${exercise.reps}</span>
                        <span class="day-detail-exercise-weight">${exercise.weight || '0'}kg</span>
                    </div>
                `;
                container.appendChild(exerciseEl);
            });
        }
        
        function startWorkout() {
            if (!currentDayDetail) return;
            
            // Resetar a flag de treino guardado
            isWorkoutSaved = false;
            
            // Inicializar o treino atual
            currentWorkout = {
                planId: currentDayDetail.plan.id,
                planName: currentDayDetail.plan.name,
                dayIndex: currentDayDetail.dayIndex,
                dayName: currentDayDetail.day.name,
                exercises: JSON.parse(JSON.stringify(currentDayDetail.day.exercises)),
                startTime: new Date(),
                completedExercises: []
            };
            
            // Inicializar os resultados para cada exercício
            currentWorkout.exercises.forEach(exercise => {
                exercise.results = [];
                for (let i = 0; i < exercise.sets; i++) {
                    exercise.results.push({
                        repetitions: '',
                        weight: ''
                    });
                }
            });
            
            // Guardar o treino em progresso
            saveOngoingWorkout(currentWorkout);
            
            // Ir para a página de treino
            showWorkoutPage();
        }

        // ===== NOVAS FUNÇÕES PARA O FLUXO DE TREINO =====
        
        function showWorkoutPage() {
            if (!currentWorkout) return;
            
            document.getElementById('workoutTitle').textContent = currentWorkout.dayName;
            const container = document.getElementById('workoutExercisesList');
            container.innerHTML = '';
            
            currentWorkout.exercises.forEach((exercise, index) => {
                const isCompleted = currentWorkout.completedExercises.includes(index);
                const exerciseEl = document.createElement('div');
                exerciseEl.className = 'workout-exercise-item';
                exerciseEl.innerHTML = `
                    <div class="workout-exercise-info">
                        <div class='workout-exercise-name'>${exercise.name}</div>
                        <div class='workout-exercise-details'>${exercise.sets} séries × ${exercise.reps} reps ${exercise.weight ? `@ ${exercise.weight} kg` : ''}</div>
                    </div>
                    <button class='workout-exercise-btn' onclick="startExercise(${index})" ${isCompleted ? 'disabled' : ''}>
                        ${isCompleted ? 'Concluído' : 'Iniciar'}
                    </button>
                `;
                container.appendChild(exerciseEl);
            });
            
            // Mostrar botão de terminar treino se todos os exercícios estiverem concluídos
            const finishBtn = document.getElementById('finishWorkoutBtn');
            if (currentWorkout.completedExercises.length === currentWorkout.exercises.length) {
                finishBtn.style.display = 'block';
            } else {
                finishBtn.style.display = 'none';
            }
            
            showPage('workoutPage');
        }
        
        function closeWorkoutPage() {
            if (isWorkoutSaved) {
                // If we're in the middle of saving, don't allow exit
                return;
            }
            showConfirmExitModal();
        }
        
        function startExercise(exerciseIndex) {
            if (!currentWorkout || !currentWorkout.exercises[exerciseIndex]) return;
            
            currentExerciseIndex = exerciseIndex;
            const exercise = currentWorkout.exercises[exerciseIndex];
            
            document.getElementById('exerciseWorkoutTitle').textContent = exercise.name;
            document.getElementById('exerciseWorkoutTarget').textContent = `Objetivo: ${exercise.sets}x${exercise.reps} ${exercise.weight ? `@ ${exercise.weight} kg` : ''}`;
            
            // Criar a grelha de séries
            const seriesGrid = document.getElementById('seriesGrid');
            seriesGrid.innerHTML = '';
            
            // Adicionar série de aquecimento se estiver ativa
            const warmupCheckbox = document.getElementById('warmupCheckbox');
            if (warmupCheckbox.checked) {
                const warmupEl = document.createElement('div');
                warmupEl.className = 'series-item';
                warmupEl.innerHTML = `
                    <div class="series-header">
                        <div class="series-number">Aquecimento</div>
                    </div>
                    <div class="series-inputs" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <div class="input-group">
                            <label class="input-label">Repetições</label>
                            <input type="number" class="series-input" id="warmup-reps" placeholder="Reps" min="0">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Peso (kg)</label>
                            <input type="number" class="series-input" id="warmup-weight" placeholder="Peso" step="0.5" min="0">
                        </div>
                    </div>
                `;
                seriesGrid.appendChild(warmupEl);
            }
            
            exercise.results.forEach((result, index) => {
                const seriesEl = document.createElement('div');
                seriesEl.className = 'series-item';
                seriesEl.innerHTML = `
                    <div class="series-header">
                        <div class="series-number">${index + 1}ª Série</div>
                    </div>
                    <div class="series-inputs" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <div class="input-group">
                            <label class="input-label">Repetições</label>
                            <input type="number" class="series-input" id="reps-${index}" value="${result.repetitions}" placeholder="Reps" min="0" oninput="validateExerciseForm()">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Peso (kg)</label>
                            <input type="number" class="series-input" id="weight-${index}" value="${result.weight}" placeholder="Peso" step="0.5" min="0" oninput="validateExerciseForm()">
                        </div>
                    </div>
                `;
                seriesGrid.appendChild(seriesEl);
            });
            
            // Reiniciar o temporizador
            timerSeconds = 120;
            updateTimerButton();
            
            // Validar formulário inicialmente
            validateExerciseForm();
            
            showPage('exerciseWorkoutPage');
        }
        
        function closeExerciseWorkout() {
            showWorkoutPage();
        }
        
        function validateExerciseForm() {
            const exercise = currentWorkout.exercises[currentExerciseIndex];
            let allFilled = true;
            
            for (let i = 0; i < exercise.results.length; i++) {
                const reps = document.getElementById(`reps-${i}`).value;
                const weight = document.getElementById(`weight-${i}`).value;
                
                if (!reps || !weight) {
                    allFilled = false;
                    break;
                }
            }
            
            const finishBtn = document.getElementById('finishExerciseBtn');
            finishBtn.disabled = !allFilled;
        }
        
        function finishExercise() {
            const exercise = currentWorkout.exercises[currentExerciseIndex];
            let allFilled = true;
            
            for (let i = 0; i < exercise.results.length; i++) {
                const reps = document.getElementById(`reps-${i}`).value;
                const weight = document.getElementById(`weight-${i}`).value;
                
                if (!reps || !weight) {
                    allFilled = false;
                    break;
                }
            }
            
            if (!allFilled) {
                alert('Por favor, preencha todos os campos das séries antes de terminar o exercício.');
                return;
            }
            
            // Guardar os resultados inseridos
            for (let i = 0; i < exercise.results.length; i++) {
                exercise.results[i].repetitions = document.getElementById(`reps-${i}`).value;
                exercise.results[i].weight = document.getElementById(`weight-${i}`).value;
            }
            
            // Guardar série de aquecimento se existir
            const warmupCheckbox = document.getElementById('warmupCheckbox');
            if (warmupCheckbox.checked) {
                const warmupReps = document.getElementById('warmup-reps').value;
                const warmupWeight = document.getElementById('warmup-weight').value;
                
                if (warmupReps || warmupWeight) {
                    exercise.warmup = {
                        repetitions: warmupReps,
                        weight: warmupWeight
                    };
                }
            }
            
            // Adicionar à lista de exercícios concluídos SEM alterar a ordem
            if (!currentWorkout.completedExercises.includes(currentExerciseIndex)) {
                currentWorkout.completedExercises.push(currentExerciseIndex);
            }
            
            // Guardar o treino em progresso
            saveOngoingWorkout(currentWorkout);
            
            // Voltar para a página do treino
            showWorkoutPage();
        }
        
        // ===== Funções para o FLUXO DE TREINO =====
        function finishWorkout() {
            if (isWorkoutSaved) return;

            if (!currentWorkout) return;

            isWorkoutSaved = true;
            const finishBtn = document.getElementById('finishWorkoutBtn');
            finishBtn.disabled = true;
            finishBtn.textContent = 'A guardar...';

            try {
                const endTime = new Date();
                const durationMs = endTime - currentWorkout.startTime;
                const minutes = Math.floor(durationMs / 60000);
                const seconds = Math.floor((durationMs % 60000) / 1000);
                
                currentWorkout.endTime = endTime;
                currentWorkout.duration = `${minutes}m ${seconds}s`;

                const workouts = loadWorkoutsData();
                
                // Verificação de duplicados corrigida
                const workoutExists = workouts.some(w => 
                    new Date(w.startTime).getTime() === new Date(currentWorkout.startTime).getTime() && 
                    w.planId === currentWorkout.planId
                );

                if (!workoutExists) {
                    workouts.push(currentWorkout);
                    saveWorkoutsData(workouts);
                }

                // Atualizar histórico de exercícios
                updateExerciseHistory(currentWorkout);
                
                // ATUALIZAR OBJETIVOS DO PLANO BASEADO NO DESEMPENHO
                updatePlanTargetsBasedOnPerformance(currentWorkout);
                
                // Guardar uma referência ao treino atual antes de limpar
                const workoutForSummary = currentWorkout;
                clearOngoingWorkout();
                showWorkoutSummary(workoutForSummary);

                // Resetar o estado do botão após um breve delay
                setTimeout(() => {
                    isWorkoutSaved = false;
                    finishBtn.disabled = false;
                    finishBtn.textContent = 'Terminar Treino';
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao terminar treino:', error);
                showToast('Erro ao guardar treino');
                isWorkoutSaved = false;
                finishBtn.disabled = false;
                finishBtn.textContent = 'Terminar Treino';
            }
        }
        
        function showWorkoutSummary(workout) {
            if (!workout) return;
            
            document.getElementById('summaryPlanName').textContent = workout.dayName;
            document.getElementById('summaryDuration').textContent = workout.duration;
            
            const container = document.getElementById('summaryExercisesList');
            container.innerHTML = '';
            
            workout.exercises.forEach(exercise => {
                const exerciseEl = document.createElement('div');
                exerciseEl.className = 'summary-exercise';
                
                let setsHTML = '';
                if (exercise.results) {
                    setsHTML = exercise.results.map((set, index) => {
                        return `S${index + 1}: ${set.repetitions}×${set.weight}kg`;
                    }).join(', ');
                }
                
                exerciseEl.innerHTML = `
                    <div><strong>${exercise.name}</strong></div>
                    <div>${setsHTML}</div>
                `;
                container.appendChild(exerciseEl);
            });
            
            showPage('workoutSummaryPage');
        }
        
        function closeWorkoutSummary() {
            showPage('mainPage');
        }
        
        // CORREÇÃO: Garantir que a função updateExerciseHistory é chamada corretamente
        function updateExerciseHistory(workout) {
            const exercisesData = loadExercisesData();
            
            workout.exercises.forEach(exercise => {
                if (!exercisesData[exercise.name]) {
                    exercisesData[exercise.name] = { history: [] };
                }
                
                // Calcular totais para este exercício neste treino
                let totalReps = 0;
                let totalVolume = 0;
                let maxWeight = 0;
                
                if (exercise.results) {
                    exercise.results.forEach(set => {
                        const reps = parseInt(set.repetitions) || 0;
                        const weight = parseFloat(set.weight) || 0;
                        totalReps += reps;
                        totalVolume += reps * weight;
                        if (weight > maxWeight) maxWeight = weight;
                    });
                }
                
                const averageWeightPerRep = totalReps > 0 ? totalVolume / totalReps : 0;
                
                // Adicionar ao histórico
                exercisesData[exercise.name].history.push({
                    date: workout.startTime.toISOString().split('T')[0],
                    startTime: workout.startTime,
                    sets: exercise.results || [],
                    totalReps: totalReps,
                    totalVolume: totalVolume,
                    averageWeightPerRep: averageWeightPerRep,
                    maxWeight: maxWeight
                });
            });
            
            saveExercisesData(exercisesData);
            
            // Se estamos na página de detalhes do exercício, atualizar as estatísticas
            if (currentPage === 'exerciseDetailPage' && currentExercise) {
                const exerciseData = getExercisesData()[currentExercise] || { history: [] };
                updateExerciseStats(exerciseData.history);
            }
        }

        // ===== Funções para a Página de Treinos (Histórico) =====
        function renderWorkouts() {
            const q = (document.getElementById('workoutSearch').value || '').toLowerCase();
            const list = document.getElementById('workoutsList');
            let items = loadWorkoutsData();
            
            // Aplicar filtros
            if (workoutFilters.dateStart) {
                items = items.filter(w => new Date(w.startTime) >= new Date(workoutFilters.dateStart));
            }
            
            if (workoutFilters.dateEnd) {
                items = items.filter(w => new Date(w.startTime) <= new Date(workoutFilters.dateEnd));
            }
            
            if (workoutFilters.plan) {
                items = items.filter(w => w.planName === workoutFilters.plan);
            }
            
            // Aplicar pesquisa por texto
            if (q) {
                items = items.filter(w => 
                    w.planName.toLowerCase().includes(q) || 
                    w.dayName.toLowerCase().includes(q) ||
                    (w.exercises && w.exercises.some(e => e.name.toLowerCase().includes(q)))
                );
            }
            
            // Ordenar do mais recente para o mais antigo
            items.sort((a, b) => new Date(b.startTime) - new Date(a.startTime));
            
            if (items.length === 0) {
                list.innerHTML = '<div class="card">Nenhum treino encontrado.</div>';
                return;
            }
            
            list.innerHTML = items.map(w => {
                const date = new Date(w.startTime);
                const formattedDate = date.toLocaleDateString('pt-PT');
                const formattedTime = date.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
                
                return `
                <div class="workout-item-compact" onclick="openWorkoutDetailModal('${w.startTime}')">
                    <div class="workout-header-compact">
                        <div class="workout-title-compact">${w.dayName}</div>
                        <div class="workout-date-compact">${formattedDate}<br>${formattedTime}</div>
                    </div>
                    <div class="workout-details-compact">
                        <div class="workout-day-compact">${w.planName}</div>
                        <div class="workout-duration-compact">${w.duration || 'N/A'}</div>
                    </div>
                </div>
                `;
            }).join('');
        }
        
        function openWorkoutDetailModal(startTime) {
            const workouts = loadWorkoutsData();
            const workout = workouts.find(w => w.startTime === startTime);
            if (!workout) return;
            
            currentWorkoutDetail = workout;
            
            const date = new Date(workout.startTime);
            const formattedDate = date.toLocaleDateString('pt-PT');
            const formattedTime = date.toLocaleTimeString('pt-PT', { hour: '2-digit', minute: '2-digit' });
            
            // Preencher informações do treino
            const infoEl = document.getElementById('workoutDetailInfo');
            infoEl.innerHTML = `
                <div class="workout-detail-info-item">
                    <span class="workout-detail-info-label">Plano:</span>
                    <span class="workout-detail-info-value">${workout.planName}</span>
                </div>
                <div class="workout-detail-info-item">
                    <span class="workout-detail-info-label">Dia:</span>
                    <span class="workout-detail-info-value">${workout.dayName}</span>
                </div>
                <div class="workout-detail-info-item">
                    <span class="workout-detail-info-label">Data:</span>
                    <span class="workout-detail-info-value">${formattedDate}</span>
                </div>
                <div class="workout-detail-info-item">
                    <span class="workout-detail-info-label">Hora:</span>
                    <span class="workout-detail-info-value">${formattedTime}</span>
                </div>
                <div class="workout-detail-info-item">
                    <span class="workout-detail-info-label">Duração:</span>
                    <span class="workout-detail-info-value">${workout.duration || 'N/A'}</span>
                </div>
            `;
            
            // Preencher exercícios do treino
            const exercisesEl = document.getElementById('workoutDetailExercises');
            exercisesEl.innerHTML = '';
            
            if (workout.exercises && workout.exercises.length) {
                workout.exercises.forEach(exercise => {
                    const exerciseEl = document.createElement('div');
                    exerciseEl.className = 'workout-detail-exercise';
                    exerciseEl.innerHTML = `
                        <div class="workout-detail-exercise-header" onclick="this.parentElement.classList.toggle('expanded')">
                            <div class="workout-detail-exercise-name">${exercise.name}</div>
                            <div>${exercise.sets} séries</div>
                        </div>
                        <div class="workout-detail-exercise-details">
                            <div class="workout-detail-set">
                                <div class="workout-detail-set-header">Série</div>
                                <div class="workout-detail-set-header">Reps</div>
                                <div class="workout-detail-set-header">Peso</div>
                            </div>
                            ${exercise.results.map((set, i) => `
                                <div class="workout-detail-set">
                                    <div>${i + 1}</div>
                                    <div>${set.repetitions}</div>
                                    <div>${set.weight} kg</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    exercisesEl.appendChild(exerciseEl);
                });
            }
            
            document.getElementById('workoutDetailModal').style.display = 'block';
        }
        
        function closeWorkoutDetailModal() {
            document.getElementById('workoutDetailModal').style.display = 'none';
        }
        
        function deleteWorkout() {
            openDeleteWorkoutConfirmModal();
        }

        // ===== Funções para o Temporizador =====
        function startTimer() {
            const timerBtn = document.getElementById('timerBtnSmall');
            
            if (timerInterval) {
                // Parar o temporizador
                clearInterval(timerInterval);
                timerInterval = null;
                timerBtn.classList.remove('timer-active');
                timerBtn.innerHTML = '<i class="bi bi-stopwatch"></i>';
                return;
            }
            
            // Iniciar o temporizador
            timerInterval = setInterval(updateTimer, 1000);
            timerBtn.classList.add('timer-active');
            updateTimerButton();
        }
        
        function updateTimer() {
            if (timerSeconds > 0) {
                timerSeconds--;
                updateTimerButton();
            } else {
                // Tempo acabou
                clearInterval(timerInterval);
                timerInterval = null;
                document.getElementById('timerBtnSmall').classList.remove('timer-active');
                document.getElementById('timerBtnSmall').innerHTML = '<i class="bi bi-stopwatch"></i>';
                
                // Tocar som de alarme (se disponível)
                try {
                    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbVtfdJivrJBhNjVgodDbq2EcBj+a2/LDci0FLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrHn6atVFApGn+DuwGwaBjKF0fDReSsFJHfH8N2QQAoUXrHn6atVFApGn+DuwGwaBjKF0fDReSsFJHfH8N2QQAoUXrHn6atVFApGn+DuwGwaBjKF0fDReSsFJHfH8N2QQAoUXrHn6atVFApGn+DuwGwaBjKF0fDReSsFJHfH8N2QQAoUXrHn6atVFApGn+DuwGwaBjKF0fDReSsFJHfH8N2QQAoUXrHn6atVFApGn+DuwGwaBjKF0fDReSsFJHfH8N2QQAoUXrHn6atVFApGn+DuwGwaBjKF0fDReSsFJHfH8N2QQAoUXrHn6atVFApGn+DuwGwaBjKF0fDReSsFJHfH8N2QQAoUXrHn6atVFApGn+DuwGwaBjKF0fDReSsFJHfH8N2QQAoUXrHn6atVFApGn+DuwGwaBjKF0fDReSsFJHfH8N2QQAo');
                    audio.play();
                } catch (e) {
                    console.log('Não foi possível tocar o som do alarme');
                }
            }
        }
        
        function updateTimerButton() {
            const timerBtn = document.getElementById('timerBtnSmall');
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            timerBtn.innerHTML = `<i class="bi bi-stopwatch"></i> ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }
        
        function toggleWarmupSet() {
            // Recarregar o exercício para mostrar/ocultar a série de aquecimento
            if (currentExerciseIndex !== null) {
                startExercise(currentExerciseIndex);
            }
        }
        
        function showExerciseInfo() {
            if (!currentExercise) return;
            
            // Carregar informações do exercício
            const exerciseData = getExercisesData()[currentExercise] || { notes: '' };
            
            document.getElementById('exerciseInfoTitle').textContent = currentExercise;
            document.getElementById('exerciseInfoContent').innerHTML = `
                <p>${exerciseData.notes || 'Sem notas para este exercício.'}</p>
            `;
            
            document.getElementById('exerciseInfoModal').style.display = 'block';
        }
        
        function closeExerciseInfo() {
            document.getElementById('exerciseInfoModal').style.display = 'none';
        }

        // ===== Funções para a Seleção de Planos =====
        function openPlanSelection() {
            const plans = loadPlansData();
            const list = document.getElementById('planSelectionList');
            
            if (!plans.length) {
                list.innerHTML = '<div class="card">Sem planos ainda.</div>';
            } else {
                list.innerHTML = plans.map(p => `
                    <div class="plan-selection-item" onclick="selectPlan('${p.id}')">
                        <div class="title">${p.name}</div>
                        <div class="subtitle">${(p.days || []).length} dias</div>
                    </div>
                `).join('');
            }
            
            document.getElementById('planSelectionModal').style.display = 'block';
        }
        
        function closePlanSelection() {
            document.getElementById('planSelectionModal').style.display = 'none';
        }
        
        function selectPlan(planId) {
            selectedPlanId = planId;
            localStorage.setItem(storageKeys.SELECTED_PLAN, planId);
            document.getElementById('selectedPlanLabel').textContent = loadPlansData().find(p => p.id === planId)?.name || '—';
            renderSelectedPlanDays();
            closePlanSelection();
            showToast('Plano selecionado!');
        }

        // ===== Funções para Filtros =====
        function openExerciseFilterModal() {
            // Preencher os checkboxes com os valores atuais
            exerciseFilters.muscleGroups.forEach(muscle => {
                const checkbox = document.getElementById(`filter${muscle}`);
                if (checkbox) checkbox.checked = true;
            });
            
            // Preencher a ordenação
            document.getElementById('exerciseSort').value = exerciseFilters.sortBy;
            
            document.getElementById('exerciseFilterModal').style.display = 'block';
        }
        
        function closeExerciseFilterModal() {
            document.getElementById('exerciseFilterModal').style.display = 'none';
        }
        
        function applyExerciseFilters() {
            // Obter grupos musculares selecionados
            const muscleGroups = [];
            ['Chest', 'Back', 'Legs', 'Shoulders', 'Arms', 'Other'].forEach(muscle => {
                const checkbox = document.getElementById(`filter${muscle}`);
                if (checkbox && checkbox.checked) {
                    muscleGroups.push(checkbox.value);
                }
            });
            
            // Obter ordenação
            const sortBy = document.getElementById('exerciseSort').value;
            
            // Aplicar filtros
            exerciseFilters.muscleGroups = muscleGroups;
            exerciseFilters.sortBy = sortBy;
            
            // Fechar modal e renderizar exercícios
            closeExerciseFilterModal();
            renderExercises();
        }
        
        function clearExerciseFilters() {
            exerciseFilters = {
                muscleGroups: [],
                sortBy: 'name'
            };
            
            // Desmarcar todos os checkboxes
            ['Chest', 'Back', 'Legs', 'Shoulders', 'Arms', 'Other'].forEach(muscle => {
                const checkbox = document.getElementById(`filter${muscle}`);
                if (checkbox) checkbox.checked = false;
            });
            
            // Definir ordenação padrão
            document.getElementById('exerciseSort').value = 'name';
            
            // Renderizar exercícios
            renderExercises();
        }
        
        function openWorkoutFilterModal() {
            // Preencher o dropdown de planos
            const planSelect = document.getElementById('workoutFilterPlan');
            const plans = loadPlansData();
            
            planSelect.innerHTML = '<option value="">Todos os planos</option>';
            plans.forEach(plan => {
                planSelect.innerHTML += `<option value="${plan.name}">${plan.name}</option>`;
            });
            
            // Preencher com os valores atuais
            if (workoutFilters.dateStart) {
                document.getElementById('workoutFilterDateStart').value = workoutFilters.dateStart;
            }
            
            if (workoutFilters.dateEnd) {
                document.getElementById('workoutFilterDateEnd').value = workoutFilters.dateEnd;
            }
            
            if (workoutFilters.plan) {
                document.getElementById('workoutFilterPlan').value = workoutFilters.plan;
            }
            
            document.getElementById('workoutFilterModal').style.display = 'block';
        }
        
        function closeWorkoutFilterModal() {
            document.getElementById('workoutFilterModal').style.display = 'none';
        }
        
        function applyWorkoutFilters() {
            // Obter valores dos filtros
            const dateStart = document.getElementById('workoutFilterDateStart').value;
            const dateEnd = document.getElementById('workoutFilterDateEnd').value;
            const plan = document.getElementById('workoutFilterPlan').value;
            
            // Aplicar filtros
            workoutFilters.dateStart = dateStart || null;
            workoutFilters.dateEnd = dateEnd || null;
            workoutFilters.plan = plan || null;
            
            // Fechar modal e renderizar treinos
            closeWorkoutFilterModal();
            renderWorkouts();
        }
        
        function clearWorkoutFilters() {
            workoutFilters = {
                dateStart: null,
                dateEnd: null,
                plan: null
            };
            
            // Limpar campos
            document.getElementById('workoutFilterDateStart').value = '';
            document.getElementById('workoutFilterDateEnd').value = '';
            document.getElementById('workoutFilterPlan').value = '';
            
            // Renderizar treinos
            renderWorkouts();
        }

        // ===== Funções para o Treino em Progresso =====
        function saveOngoingWorkout(workout) {
            localStorage.setItem(storageKeys.ONGOING_WORKOUT, JSON.stringify(workout));
            ongoingWorkout = workout;
            updateResumeWorkoutCard();
        }
        
        function clearOngoingWorkout() {
            localStorage.removeItem(storageKeys.ONGOING_WORKOUT);
            ongoingWorkout = null;
            currentWorkout = null;
            updateResumeWorkoutCard();
        }
        
        function updateResumeWorkoutCard() {
            const card = document.getElementById('resumeWorkoutCard');
            if (ongoingWorkout) {
                card.style.display = 'flex';
                document.getElementById('resumeWorkoutDetails').textContent = `${ongoingWorkout.dayName} - ${ongoingWorkout.completedExercises.length}/${ongoingWorkout.exercises.length} exercícios`;
            } else {
                card.style.display = 'none';
            }
        }
        
        function resumeWorkout() {
            if (!ongoingWorkout) return;
            
            currentWorkout = ongoingWorkout;
            showWorkoutPage();
        }

        // ===== Funções para a Página Home =====
        function renderSelectedPlanDays() {
            if (!selectedPlanId) {
                document.getElementById('selectedPlanDays').innerHTML = '';
                return;
            }
            
            const plans = loadPlansData();
            const plan = plans.find(p => p.id === selectedPlanId);
            if (!plan) return;
            
            let html = '';
            (plan.days || []).forEach((day, index) => {
                html += `
                <div class="day-card">
                    <div class="day-number-box">
                        <div>DIA</div>
                        <div>${index + 1}</div>
                    </div>
                    <div>
                        <h5>${day.name}</h5>
                        <small>${day.exercises ? day.exercises.length : 0} exercícios</small>
                    </div>
                    <button class="start-workout-btn-home" onclick="startWorkoutFromHome('${plan.id}', ${index})">Iniciar Treino</button>
                </div>`;
            });
            
            document.getElementById('selectedPlanDays').innerHTML = html;
        }
        
        function startWorkoutFromHome(planId, dayIndex) {
            const plans = loadPlansData();
            const plan = plans.find(p => p.id === planId);
            if (!plan || !plan.days || !plan.days[dayIndex]) return;
            
            currentDayDetail = {
                plan: plan,
                dayIndex: dayIndex,
                day: plan.days[dayIndex]
            };
            
            startWorkout();
        }

        // ===== Funções de Utilidade =====
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            currentPage = pageId;
            
            // Atualizar navbar
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            const navItem = document.querySelector(`.nav-item:nth-child(${getNavIndex(pageId)})`);
            if (navItem) navItem.classList.add('active');
            
            // Executar ações específicas de página
            if (pageId === 'mainPage') {
                renderSelectedPlanDays();
                updateResumeWorkoutCard();
            } else if (pageId === 'exercisesPage') {
                renderExercises();
            } else if (pageId === 'plansPage') {
                renderPlans();
            } else if (pageId === 'weightPage') {
                initWeight();
            } else if (pageId === 'workoutsPage') {
                renderWorkouts();
            }
        }
        
        function getNavIndex(pageId) {
            switch(pageId) {
                case 'mainPage': return 1;
                case 'exercisesPage': return 2;
                case 'plansPage': return 3;
                case 'workoutsPage': return 4;
                case 'weightPage': return 5;
                default: return 1;
            }
        }
        
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => { t.classList.remove('show'); }, 3000);
        }
        
        // ===== Funções de Armazenamento =====
        function loadWeightHistory() { return JSON.parse(localStorage.getItem(storageKeys.WEIGHT_HISTORY)) || []; }
        function saveWeightHistory(hist) { localStorage.setItem(storageKeys.WEIGHT_HISTORY, JSON.stringify(hist)); }
        function loadExercisesData() { return JSON.parse(localStorage.getItem(storageKeys.EXERCISES)) || {}; }
        function saveExercisesData(data) { localStorage.setItem(storageKeys.EXERCISES, JSON.stringify(data)); }
        function loadPlansData() { return JSON.parse(localStorage.getItem(storageKeys.PLANS)) || []; }
        function savePlansData(data) { localStorage.setItem(storageKeys.PLANS, JSON.stringify(data)); }
        function loadWorkoutsData() { return JSON.parse(localStorage.getItem(storageKeys.WORKOUTS)) || []; }
        function saveWorkoutsData(data) { localStorage.setItem(storageKeys.WORKOUTS, JSON.stringify(data)); }
        function loadExerciseMediaData() { return JSON.parse(localStorage.getItem(storageKeys.EXERCISE_MEDIA)) || {}; }
        function saveExerciseMediaData(data) { localStorage.setItem(storageKeys.EXERCISE_MEDIA, JSON.stringify(data)); }

        // ===== Inicialização =====
        function init() {
            // Carregar dados iniciais
            selectedPlanId = localStorage.getItem(storageKeys.SELECTED_PLAN);
            
            // Inicializar a página de peso
            initWeight();
            
            // Inicializar a lista de exercícios
            renderExercises();
            
            // Inicializar a lista de planos
            renderPlans();
            
            // Inicializar a página home
            if (selectedPlanId) {
                const plans = loadPlansData();
                const plan = plans.find(p => p.id === selectedPlanId);
                if (plan) {
                    document.getElementById('selectedPlanLabel').textContent = plan.name;
                }
            }
            
            // Inicializar a lista de treinos
            renderWorkouts();
            
            // Verificar se há um treino em progresso
            updateResumeWorkoutCard();
            
            // Mostrar a página inicial
            showPage('mainPage');
        }
        
        // Iniciar a aplicação
        init();

        // Função para mostrar o modal de confirmação personalizado
        function showConfirmExitModal() {
            document.getElementById('confirmExitModal').style.display = 'block';
        }
        // Função para fechar o modal de confirmação
        function closeConfirmExitModal() {
            document.getElementById('confirmExitModal').style.display = 'none';
        }

        function openDeleteWorkoutConfirmModal() {
            document.getElementById('deleteWorkoutConfirmModal').style.display = 'block';
        }

        function closeDeleteWorkoutConfirmModal() {
            document.getElementById('deleteWorkoutConfirmModal').style.display = 'none';
        }

        function confirmDeleteWorkout() {
            if (!currentWorkoutDetail) return;
            
            // First, remove the workout from exercise history
            const exercisesData = loadExercisesData();
            
            currentWorkoutDetail.exercises.forEach(exercise => {
                if (exercisesData[exercise.name] && exercisesData[exercise.name].history) {
                    // Filter out the history entries for this workout
                    exercisesData[exercise.name].history = exercisesData[exercise.name].history.filter(
                        h => new Date(h.startTime).getTime() !== new Date(currentWorkoutDetail.startTime).getTime()
                    );
                }
            });
            
            saveExercisesData(exercisesData);
            
            // Then remove the workout from workouts data
            const workouts = loadWorkoutsData();
            const index = workouts.findIndex(w => w.startTime === currentWorkoutDetail.startTime);
            if (index !== -1) {
                workouts.splice(index, 1);
                saveWorkoutsData(workouts);
                showToast('Treino eliminado.');
                closeDeleteWorkoutConfirmModal();
                closeWorkoutDetailModal();
                renderWorkouts();
                
                // If we're on the exercise detail page, refresh the chart and history
                if (currentPage === 'exerciseDetailPage' && currentExercise) {
                    loadExerciseDetail(currentExercise);
                }
            }
        }

        // Atualização de Objetivos dos exercicios
        function updatePlanTargetsBasedOnPerformance(workout) {
            const plans = loadPlansData();
            const planIndex = plans.findIndex(p => p.id === workout.planId);
            
            if (planIndex === -1) return false;
            
            const plan = plans[planIndex];
            const day = plan.days[workout.dayIndex];
            let updated = false;
            
            // Para cada exercício no treino concluído
            workout.exercises.forEach(workoutExercise => {
                const planExercise = day.exercises.find(e => e.name === workoutExercise.name);
                
                if (!planExercise || !workoutExercise.results) return;
                
                const planReps = parseInt(planExercise.reps) || 0;
                const planWeight = parseFloat(planExercise.weight) || 0;
                const planTotalLoad = planReps * planWeight;
                
                // Encontrar a série com a maior carga total
                let bestTotalLoad = 0;
                let bestReps = 0;
                let bestWeight = 0;
                
                workoutExercise.results.forEach(set => {
                    const reps = parseInt(set.repetitions) || 0;
                    const weight = parseFloat(set.weight) || 0;
                    const totalLoad = reps * weight;
                    
                    if (totalLoad > bestTotalLoad) {
                        bestTotalLoad = totalLoad;
                        bestReps = reps;
                        bestWeight = weight;
                    }
                });
                
                // Verificar se a carga total foi melhor e atualizar se necessário
                if (bestTotalLoad > planTotalLoad) {
                    // Atualizar ambos - repetições e peso - para os valores da melhor série
                    planExercise.reps = bestReps.toString();
                    planExercise.weight = bestWeight.toString();
                    
                    showToast(`Objetivo atualizado: ${workoutExercise.name} - ${bestReps} reps × ${bestWeight} kg`);
                    updated = true;
                }
            });
            
            if (updated) {
                plans[planIndex] = plan;
                savePlansData(plans);
                
                // Atualizar a visualização se estivermos na página de detalhes do plano
                if (currentPage === 'planDetailPage' && currentPlanDetail && currentPlanDetail.id === plan.id) {
                    renderPlanDaysDetail(plan.days);
                }
                
                return true;
            }
            
            return false;
        }

        // Adicionar esta função auxiliar para calcular a carga total
        function calculateTotalLoad(reps, weight) {
            return (parseInt(reps) || 0) * (parseFloat(weight) || 0);
        }

        // Função confirmar saída do treino
        function confirmExitWorkout() {
            closeConfirmExitModal();
            clearOngoingWorkout();
            showPage('mainPage');
        }

        // Substituir a função closeWorkoutPage existente por esta:
        function closeWorkoutPage() {
            showConfirmExitModal();
        }
    </script>
</body>
</html>
